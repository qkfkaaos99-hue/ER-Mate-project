<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ER Mate - ìŠ¤ë§ˆíŠ¸ ê°„í˜¸ ë„ìš°ë¯¸</title>
<style>
  /* === í…Œë§ˆ ë³€ìˆ˜ === */
  :root {
    --bg: #0a0a0a; --bg2: #111; --bg3: #1a1a1a; --border: #2a2a2a; --border2: #1a1a1a;
    --text: #e0e0e0; --text2: #9a9a9a; --text3: #888; --text-dim: #666;
    --hdr-bg1: #1a2744; --hdr-bg2: #0f1a30; --hdr-border: #2a4a7a;
    --blue: #7eb8f7; --green: #6adb6a; --red: #ff6b6b; --yellow: #f0c040; --orange: #f0a040;
    --input-bg: #0a0a0a; --input-border: #333; --input-text: #e0e0e0;
    --row-hover: #1a1a2a; --row-hl: #1a1010;
    --cb-bg: #0a0a0a; --cb-border: #444; --cb-checked: #2a6a2a; --cb-checked-border: #4a8a4a;
    --section-cond-bg1: #2a1515; --section-cond-bg2: #1a0a0a; --section-cond-border: #4a2020;
    --section-mand-bg1: #152215; --section-mand-bg2: #0a150a; --section-mand-border: #2a3a2a;
    --panel-hdr-bg1: #1e3050; --panel-hdr-bg2: #152238; --panel-hdr-border: #2a4a6a;
    --modal-bg: #111; --modal-hdr-bg1: #3a3000; --modal-hdr-bg2: #2a2000; --modal-border: #4a3a00;
    --modal-text: #ddd;
    --complete-bg: #0a1a0a; --complete-border: #2a4a2a;
    --overlay-bg: rgba(0,0,0,0.8);
    --btn-ex-bg: #151515; --btn-ex-border: #2a2a2a; --btn-ex-text: #8aba8a;
    --tab-bg: #1a1a1a; --tab-border: #333;
    --task-text: #e8e8e8; --task-done: #555; --detail-done: #444;
    --logo-bg: #2a6abf;
    --dispo-bar-bg: #0f1a30;
    --warn-bg: #1a1500; --warn-border: #4a3a00;
    --prog-bg: #222;
    --svg-check: #fff;
  }
  body.light {
    --bg: #f4f5f7; --bg2: #fff; --bg3: #eef0f2; --border: #d0d4da; --border2: #e2e5ea;
    --text: #1a1a2e; --text2: #555; --text3: #777; --text-dim: #999;
    --hdr-bg1: #1e3a5f; --hdr-bg2: #15294a; --hdr-border: #2a5a9a;
    --blue: #2a6abf; --green: #1a8a1a; --red: #d04040; --yellow: #b08000; --orange: #c07020;
    --input-bg: #fff; --input-border: #c0c4ca; --input-text: #1a1a2e;
    --row-hover: #e8eaf0; --row-hl: #fef0f0;
    --cb-bg: #fff; --cb-border: #aaa; --cb-checked: #2a8a2a; --cb-checked-border: #1a6a1a;
    --section-cond-bg1: #fef0f0; --section-cond-bg2: #fff5f5; --section-cond-border: #e0a0a0;
    --section-mand-bg1: #f0faf0; --section-mand-bg2: #f5fff5; --section-mand-border: #a0c0a0;
    --panel-hdr-bg1: #1e3a5f; --panel-hdr-bg2: #15294a; --panel-hdr-border: #2a5a9a;
    --modal-bg: #fff; --modal-hdr-bg1: #fff3d0; --modal-hdr-bg2: #ffedaa; --modal-border: #d0a030;
    --modal-text: #333;
    --complete-bg: #f0faf0; --complete-border: #a0c0a0;
    --overlay-bg: rgba(0,0,0,0.4);
    --btn-ex-bg: #eef0f2; --btn-ex-border: #c0c4ca; --btn-ex-text: #2a7a2a;
    --tab-bg: #eef0f2; --tab-border: #c0c4ca;
    --task-text: #1a1a2e; --task-done: #aaa; --detail-done: #ccc;
    --logo-bg: #2a6abf;
    --dispo-bar-bg: #e8f0fa;
    --warn-bg: #fff8e0; --warn-border: #d0a030;
    --prog-bg: #d0d4da;
    --svg-check: #fff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { min-height: 100vh; background: var(--bg); font-family: 'Malgun Gothic', -apple-system, sans-serif; color: var(--text); font-size: 13px; transition: background .2s, color .2s; }
  header { background: linear-gradient(180deg, var(--hdr-bg1), var(--hdr-bg2)); border-bottom: 2px solid var(--hdr-border); padding: 6px 12px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
  .hdr-left { display: flex; align-items: center; gap: 8px; }
  .hdr-logo { background: var(--logo-bg); color: #fff; font-weight: 800; font-size: 11px; padding: 3px 6px; border-radius: 2px; }
  .hdr-title { color: #fff; font-weight: 700; font-size: 13px; }
  .hdr-sub { color: #8aa; font-size: 11px; margin-left: 6px; }
  .hdr-right { display: flex; align-items: center; gap: 6px; }
  .btn-new { background: var(--hdr-bg1); border: 1px solid var(--hdr-border); color: #fff; padding: 6px 14px; font-size: 12px; cursor: pointer; border-radius: 2px; display: none; touch-action: manipulation; }
  .btn-theme { background: none; border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 6px 10px; font-size: 14px; cursor: pointer; border-radius: 2px; line-height: 1; touch-action: manipulation; }
  .btn-theme:hover { background: rgba(255,255,255,0.1); }
  .toolbar { background: var(--bg2); border-bottom: 1px solid var(--border); padding: 4px 12px; display: flex; gap: 2px; }
  .tab { padding: 4px 14px; font-size: 11px; background: var(--tab-bg); border: 1px solid var(--tab-border); border-bottom: none; color: var(--yellow); border-radius: 3px 3px 0 0; font-weight: 700; }
  main { max-width: 700px; margin: 0 auto; padding: 8px 10px 80px; }
  .input-panel { background: var(--bg2); border: 1px solid var(--border); border-radius: 2px; margin-bottom: 8px; }
  .input-header { background: linear-gradient(180deg, var(--panel-hdr-bg1), var(--panel-hdr-bg2)); padding: 5px 10px; font-size: 11px; font-weight: 700; color: #fff; border-bottom: 1px solid var(--panel-hdr-border); }
  .input-body { padding: 8px; }
  textarea { width: 100%; min-height: 100px; padding: 8px; background: var(--input-bg); border: 1px solid var(--input-border); color: var(--input-text); font-family: 'Malgun Gothic', monospace; font-size: 12px; resize: vertical; outline: none; line-height: 1.7; border-radius: 1px; }
  textarea:focus { border-color: var(--blue); }
  textarea::placeholder { color: var(--text-dim); }
  
  .btn-run { width: 100%; margin-top: 6px; padding: 14px 0; background: var(--hdr-bg1); border: 1px solid var(--hdr-border); color: var(--text-dim); font-size: 14px; font-weight: 700; cursor: pointer; border-radius: 4px; -webkit-tap-highlight-color: rgba(0,0,0,0); touch-action: manipulation; user-select: none; -webkit-user-select: none; }
  .btn-run.active { color: #fff; background: var(--blue); border-color: var(--blue); }
  .btn-run.active:active { opacity: 0.7; }
  
  .examples { padding: 6px 0; display: flex; flex-wrap: wrap; gap: 4px; }
  .ex-label { font-size: 10px; color: var(--text3); margin-bottom: 4px; }
  .btn-ex { padding: 6px 12px; background: var(--btn-ex-bg); border: 1px solid var(--btn-ex-border); color: var(--btn-ex-text); font-size: 12px; cursor: pointer; border-radius: 2px; touch-action: manipulation; -webkit-tap-highlight-color: rgba(0,0,0,0); }
  .result { animation: fi 0.15s ease; }
  @keyframes fi { from{opacity:0} to{opacity:1} }
  .dispo-bar { background: var(--dispo-bar-bg); border: 1px solid var(--hdr-border); border-radius: 2px; padding: 8px 10px; margin-bottom: 6px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .dispo-emoji { font-size: 16px; }
  .dispo-type { font-size: 14px; font-weight: 800; }
  .dispo-tag { font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 2px; border: 1px solid; }
  .dispo-info { font-size: 11px; color: var(--text2); margin-left: auto; }
  .warn-bar { background: var(--warn-bg); border: 1px solid var(--warn-border); border-radius: 2px; padding: 6px 10px; margin-bottom: 6px; color: var(--yellow); font-size: 12px; }
  .progress-row { display: flex; align-items: center; gap: 8px; padding: 5px 10px; background: var(--bg2); border: 1px solid var(--border); border-radius: 2px; margin-bottom: 8px; }
  .prog-label { font-size: 10px; color: var(--text3); white-space: nowrap; }
  .prog-track { flex: 1; height: 4px; background: var(--prog-bg); border-radius: 1px; overflow: hidden; }
  .prog-fill { height: 100%; transition: width 0.3s; border-radius: 1px; }
  .prog-text { font-size: 11px; font-weight: 700; white-space: nowrap; }
  .section-hdr { border: 1px solid; border-radius: 2px; padding: 4px 10px; font-size: 11px; font-weight: 700; margin-bottom: 2px; display: flex; align-items: center; gap: 6px; }
  .section-hdr.cond { color: var(--red); border-color: var(--section-cond-border); background: linear-gradient(180deg, var(--section-cond-bg1), var(--section-cond-bg2)); }
  .section-hdr.mand { color: var(--green); border-color: var(--section-mand-border); background: linear-gradient(180deg, var(--section-mand-bg1), var(--section-mand-bg2)); }
  .section-dot { width: 6px; height: 6px; border-radius: 1px; display: inline-block; }
  .row { display: flex; align-items: flex-start; border-bottom: 1px solid var(--border2); cursor: pointer; transition: background 0.1s; touch-action: manipulation; -webkit-tap-highlight-color: rgba(0,0,0,0); }
  .row:hover { background: var(--row-hover); }
  .row.done-row { opacity: 0.3; }
  .row.hl { background: var(--row-hl); }
  .row-check { width: 32px; min-height: 34px; display: flex; align-items: center; justify-content: center; border-right: 1px solid var(--border2); flex-shrink: 0; }
  .cb { width: 14px; height: 14px; border: 1px solid var(--cb-border); background: var(--cb-bg); display: flex; align-items: center; justify-content: center; border-radius: 1px; }
  .cb.checked { background: var(--cb-checked); border-color: var(--cb-checked-border); }
  .cb svg { display: none; }
  .cb.checked svg { display: block; }
  .row-icon { width: 28px; min-height: 34px; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }
  .row-content { flex: 1; padding: 7px 10px; min-width: 0; }
  .row-task { font-size: 13px; font-weight: 600; color: var(--task-text); line-height: 1.4; }
  .row-task.done { color: var(--task-done); text-decoration: line-through; }
  .row-detail { font-size: 12px; color: var(--text2); margin-top: 3px; line-height: 1.5; }
  .row-detail.done { color: var(--detail-done); }
  .complete-bar { background: var(--complete-bg); border: 1px solid var(--complete-border); border-radius: 2px; padding: 14px; text-align: center; margin-top: 8px; }
  .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--overlay-bg); display: flex; align-items: center; justify-content: center; z-index: 999; padding: 16px; }
  .modal { background: var(--modal-bg); border: 2px solid var(--yellow); border-radius: 3px; max-width: 400px; width: 100%; box-shadow: 0 0 30px rgba(240,192,64,0.15); }
  .modal-hdr { background: linear-gradient(180deg, var(--modal-hdr-bg1), var(--modal-hdr-bg2)); padding: 8px 12px; font-size: 13px; font-weight: 700; color: var(--yellow); border-bottom: 1px solid var(--modal-border); text-align: center; }
  .modal-body { padding: 12px; }
  .modal-item { display: flex; gap: 8px; margin-bottom: 5px; font-size: 12px; color: var(--modal-text); line-height: 1.6; }
  .btn-modal-ok { width: 100%; margin-top: 10px; padding: 12px 0; background: linear-gradient(180deg, var(--modal-hdr-bg1), var(--modal-hdr-bg2)); border: 1px solid var(--modal-border); color: var(--yellow); font-size: 13px; font-weight: 700; cursor: pointer; border-radius: 2px; touch-action: manipulation; }
  details { margin-top: 10px; }
  summary { font-size: 11px; color: var(--text3); cursor: pointer; padding: 4px 0; border-bottom: 1px solid var(--border2); }
  .edit-box { margin-top: 4px; }
  .edit-box textarea { min-height: 80px; }
  .btn-regen { width: 100%; margin-top: 4px; padding: 6px 0; background: var(--hdr-bg1); border: 1px solid var(--hdr-border); color: #fff; font-size: 11px; font-weight: 700; cursor: pointer; border-radius: 2px; }
  .hidden { display: none !important; }
</style>
</head>
<body>
<header>
  <div class="hdr-left">
    <span class="hdr-logo" style="background:var(--blue);">EM</span>
    <span class="hdr-title">ER Mate</span>
    <!-- === ë²„ì „ === -->
    <span class="hdr-sub">v2.3 | 2026.02.25</span> 
  </div>
  <div class="hdr-right">
    <button class="btn-theme" id="btnTheme" onclick="toggleTheme()">â˜€ï¸</button>
    <button class="btn-new" id="btnReset" onclick="resetAll()">ìƒˆë¡œê³ ì¹¨</button>
  </div>
</header>

<div class="toolbar">
  <div class="tab">ì›Œí¬ìŠ¤í…Œì´ì…˜</div>
</div>

<main>
  <div id="inputScreen">
    <div class="input-panel">
      <div class="input-header">â–¶ ìŠ¤ë§ˆíŠ¸ ì˜¤ë” ë¶„ì„ / í”„ë¡œí† ì½œ ê²€ìƒ‰</div>
      <div class="input-body">
        <textarea id="inputText" 
          placeholder="[ì‚¬ìš©ë²•]
1. ì»¨ì„¤íŠ¸ ë³µì‚¬ë¶™ì—¬ë„£ê¸° â†’ í‡´ì‹¤ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
   ğŸ“‹ ë³µì‚¬ë²”ìœ„: [ì…ì›ê²½ê³¼] ~ [í‡´ì›ì¥ì†Œ] ê¹Œì§€
2. ì‹œìˆ ëª…(ERCP, CAG ë“±)ë§Œ ì…ë ¥ â†’ í‘œì¤€ ì§€ì¹¨ì„œ ì¦‰ì‹œ ì¡°íšŒ

Enter = ì‹¤í–‰ / Shift+Enter = ì¤„ë°”ê¿ˆ" 
          oninput="updateBtn()" onpaste="setTimeout(updateBtn,50)" onchange="updateBtn()"
          onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();generate();}"></textarea>
        <button class="btn-run active" id="btnGen">âš¡ ER Mate ë¶„ì„ ì‹¤í–‰</button>
      </div>
    </div>
    
    <div class="ex-label">ë¹ ë¥¸ ì‹¤í–‰ (ì˜ˆì‹œ)</div>
    <div class="examples" id="exCon">
    </div>

    <div style="margin-top:15px; padding:10px; background:var(--bg2); border:1px solid var(--border); border-radius:4px; font-size:11px; color:var(--text3);">
      <strong>ğŸ’¡ Tip:</strong> 'ERCP', 'PTBD' ì²˜ëŸ¼ ë‹¨ì–´ë§Œ ì…ë ¥í•˜ë©´ ì‹œìˆ  ì¤€ë¹„ì‚¬í•­ì„ ë°”ë¡œ ì•Œë ¤ë“œë ¤ìš”!<br>
<strong>ğŸ“– ê°€ì´ë“œ:</strong> 'ìˆ˜í˜ˆ', 'CIV', 'enema', 'ê³ ì¹¼ë¥¨', 'I/O', 'ê°„í˜¸ê¸°ë¡' ë“± ì—…ë¬´ í‚¤ì›Œë“œë„ ê²€ìƒ‰ ê°€ëŠ¥!<br>
<strong>ğŸ“‹ ë³µì‚¬ë²”ìœ„:</strong> ì§„ë£Œê¸°ë¡ì¡°íšŒ â†’ <u>ì…ì›ê²½ê³¼</u> ~ <u>í‡´ì›ì¥ì†Œ</u>ê¹Œì§€ ë“œë˜ê·¸ ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°!
    </div>
  </div>

  <div id="resultScreen" class="hidden result"></div>

  <div id="reminderPopup" class="overlay hidden">
    <div class="modal">
      <div class="modal-hdr">âš¡ ë†“ì¹˜ê¸° ì‰¬ìš´ í‡´ì› ì˜¤ë” ì²´í¬!</div>
      <div class="modal-body">
        <div class="modal-item"><span>ğŸ“…</span><span>ì™¸ë˜ ì˜ˆì•½ í™•ì¸í•˜ì…¨ë‚˜ìš”? (ì§ì ‘ ì˜ˆì•½ or ì£¼ì¹˜ì˜ í™•ì¸)</span></div>
        <div class="modal-item"><span>ğŸ’Š</span><span>í‡´ì›ì•½ ì ‘ìˆ˜ í™•ì¸ & ë‚¨ì€ ì•½ ë°˜ë‚©</span></div>
        <div class="modal-item"><span>ğŸ§ </span><span>íŠ¹ìˆ˜ê²€ì‚¬(EEG, Holter) ì˜ˆì•½ í™•ì¸</span></div>
        <button class="btn-modal-ok" onclick="closeReminder()">ë„¤, í™•ì¸í–ˆìŠµë‹ˆë‹¤!</button>
      </div>
    </div>
  </div>
</main>

<script>
// ==========================================
// [DOMAIN: CONFIG & CONSTANTS] í™˜ê²½ ì„¤ì • ë° ì •ì  ìƒìˆ˜ ë°ì´í„°
// - MANDATORY: dispositionë³„ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©
// - DEPT_NOTES: ì§„ë£Œê³¼ë³„ ì°¸ê³ ì‚¬í•­
// - UNIT_CONSENTS: íŠ¹ìˆ˜ìœ ë‹› ë™ì˜ì„œ ì •ë³´
// - EXAMPLES: ë¹ ë¥¸ ì‹¤í–‰ ì˜ˆì‹œ ë°ì´í„°
// - ìƒíƒœ ë³€ìˆ˜: activeTitle, cl, cs, cp, ci
// ==========================================

const MANDATORY={discharge:[{id:"m_d1",task:"í‡´ì›ì•½ í™•ì¸",detail:"ì •ê·œ:ì‘ê¸‰ì•½êµ­ ë³´í˜¸ìì§ì ‘ìˆ˜ë ¹ / ë¹„ì •ê·œ:ê¸°ì†¡ê´€orë³´ì¡°ì›SMS",icon:"ğŸ’Š"},{id:"m_d2",task:"ë‚¨ì€ì•½ ë°˜ë‚©",detail:"ë°˜ë‚©ìš©ì§€+ì•½â†’ì†Œë…ë¬¼ì‹¤+60ì‚ë¡ / ì ‘ìˆ˜ë§Œëœì•½â†’ì•½êµ­82)2592ì „í™”ì·¨ì†Œ",icon:"â†©ï¸"},{id:"m_d3",task:"Line ì œê±°",detail:"IV line ë“± ì œê±°",icon:"ğŸ’‰"},{id:"m_d4",task:"í‡´ì›ê°„í˜¸ê¸°ë¡ì§€ ì „ë‹¬",detail:"ìˆ˜ë‚© ì „ë‹¬",icon:"ğŸ“„"},{id:"m_d5",task:"ì‘ê¸‰ì‹¤í‡´ì‹¤ê°„í˜¸ê¸°ë¡",detail:"í‡´ì‹¤ì¼ì‹œ=ê°„í˜¸ê¸°ë¡'í‡´ì›í•¨'ì‹œê°„",icon:"âœï¸"},{id:"m_d6",task:"ì¹¨ìƒì •ë¦¬",detail:"#59ì‚ë¡, ì¼€ì´ë¸”Â·ì´ë¦„í‘œÂ·ì“°ë ˆê¸°ì •ë¦¬",icon:"ğŸ§¹"}],admission:[{id:"m_a1",task:"ì…ì›ì§€ì‹œ í™•ì¸",detail:"ë‚´ê³¼â†’EMO / ì™¸ê³¼â†’ì§„ë£Œê³¼ì§ì ‘ë°œí–‰",icon:"ğŸ“‹"},{id:"m_a2",task:"ë³‘ì‹¤ë°°ì •",detail:"ë³‘ë™ì „í™”â†’ìë¦¬+ìˆ˜ì†+ì¸ê³„ì‹œê°„í™•ì¸",icon:"ğŸ›ï¸"},{id:"m_a3",task:"ì…ì›ìˆ˜ì† ì•ˆë‚´",detail:"ë³´í˜¸ìì—ê²Œ ì…ì›ì§€ì‹œë¼ë²¨â†’ì‘ê¸‰ì›ë¬´ìˆ˜ë‚©ì•ˆë‚´",icon:"ğŸ¥"},{id:"m_a4",task:"ì•½ ë°˜ë‚© í™•ì¸",detail:"ë‚¨ì€ì•½ ë°˜ë‚©ì²˜ë¦¬",icon:"â†©ï¸"},{id:"m_a5",task:"ì „ê³¼ì „ë™ê¸°ë¡ì§€",detail:"ì¸ê³„ì „ ì˜¬ë ¤ë†“ê¸°",icon:"ğŸ“„"},{id:"m_a6",task:"ì¸ê³„",detail:"ê²€ì²´Â·pen insulinë“± í•¨ê»˜ì¸ê³„. ìˆ˜í˜ˆë‚¨ìœ¼ë©´ ë³‘ë™ì•Œë¦¬ê¸°",icon:"ğŸ¤"},{id:"m_a7",task:"ì´ì†¡ë“±ë¡",detail:"í‡´ì‹¤ì „ ë¯¸ë¦¬ë“±ë¡!(ì´ë¦„ë¹ ì§€ë©´ ì´ì†¡ëª»í•¨)",icon:"ğŸš¶"},{id:"m_a8",task:"ì‘ê¸‰ì‹¤í‡´ì‹¤ê°„í˜¸ê¸°ë¡",detail:"ì²˜ì¹˜Â·ê²€ì‚¬Â·ì˜¤ë” ì¬í™•ì¸í›„ ì‘ì„±",icon:"âœï¸"},{id:"m_a9",task:"ì¹¨ìƒì •ë¦¬",detail:"#59ì‚ë¡, ì¼€ì´ë¸”Â·ì´ë¦„í‘œì •ë¦¬",icon:"ğŸ§¹"}],transfer:[{id:"m_t1",task:"ì „ì›ë™ì˜ì„œ",detail:"ì£¼ì¹˜ì˜ë°ì˜ë¢°í•œê°ê³¼",icon:"ğŸ“"},{id:"m_t2",task:"ì „ì›ì†Œê²¬ì„œ",detail:"ì´ì†¡ìˆ˜ë‹¨Â·ë³‘ì›ì´ë¦„. ì •ê·œ:ì „ì›ì „ë‹´ê°„í˜¸ì‚¬",icon:"ğŸ“„"},{id:"m_t3",task:"ì˜ë¬´ê¸°ë¡ë³µì‚¬",detail:"ì „ì›ì „ë‹´ê°„í˜¸ì‚¬",icon:"ğŸ“‹"},{id:"m_t4",task:"CD/DVDë³µì‚¬",detail:"ë¹„ì •ê·œ:PACSì‹¤82)3077â†’SMSë³´ì¡°ì›ìˆ˜ë ¹",icon:"ğŸ’¿"},{id:"m_t5",task:"ì „ì›íšŒì‹ í™•ì¸",detail:"ì§„ë£Œí˜‘ë ¥ì„¼í„°ê²½ìœ ì—¬ë¶€í™•ì¸",icon:"ğŸ“"},{id:"m_t6",task:"êµ¬ê¸‰ì°¨ì•ˆë‚´",detail:"ì‚¬ì„¤ê¸°ë³¸8ë§Œì›/ì±„í˜ˆì‹¤#0896",icon:"ğŸš‘"},{id:"m_t7",task:"í‡´ì‹¤30ë¶„ì „V/S",detail:"ë¬¸ì œì‹œì „ì›ì „ë‹´ìŒ¤ì•Œë¦¬ê¸°!",icon:"ğŸ’“"},{id:"m_t8",task:"í‡´ì›ì•½í™•ì¸",detail:"í•„ìš”ì‹œí‡´ì›ì•½ì•ˆë‚´",icon:"ğŸ’Š"},{id:"m_t9",task:"ì™¸ë˜ì˜ˆì•½í™•ì¸",detail:"ë‹¤ìŒì™¸ë˜ê¼­í™•ì¸!",icon:"ğŸ“…"},{id:"m_t10",task:"ì‘ê¸‰ì‹¤í‡´ì‹¤ê°„í˜¸ê¸°ë¡",detail:"ì‘ì„±&ì´ë¦„ë¹¼ê¸°",icon:"âœï¸"},{id:"m_t11",task:"ì¹¨ìƒì •ë¦¬",detail:"#59ì‚ë¡ì •ë¦¬",icon:"ğŸ§¹"}]};

const DEPT_NOTES={"GS":"ì •ê·œ:ì™¸ê³¼ì‚¬ë¬´ì‹¤/ë¹„ì •ê·œ:ìˆ˜ë‚©ë¼ë²¨â†’ë³‘ë™","NS":"êµìˆ˜ë‹˜ì–´ë ˆì¸ì§€ í™•ì¸í•„ìš”"};
const UNIT_CONSENTS={"ICU":"ì¤‘í™˜ìì‹¤ì…ì‹¤ë™ì˜ì„œ","CCU":"ì‹¬í˜ˆê´€ë‚´ê³¼ì¤‘í™˜ìì‹¤ ì…ì‹¤ë™ì˜ì„œ","Stroke":"ë‡Œì¡¸ì¤‘ì§‘ì¤‘ì¹˜ë£Œì‹¤ë™ì˜ì„œ (ë³´í˜¸ì 24hr 1ì¸ ìƒì£¼ í•„ìˆ˜) â˜0309","LICU":"ê°„ì§‘ì¤‘ì¹˜ë£Œì‹¤ì…ì‹¤ë™ì˜ì„œ (ë³´í˜¸ì 24hr 1ì¸ ìƒì£¼ í•„ìˆ˜, 114ë³‘ë™) â˜2670"};
const EXAMPLES=[{label:"ê°„ë‹¨í‡´ì›",text:"routine w/uìƒ íŠ¹ì´ì†Œê²¬ ì—†ì–´ì„œ r/o URI\nD/C, IMHO opd f/u as scheduled"},{label:"êµìœ¡í¬í•¨í‡´ì›",text:"[ì…ì›ê²°ê³¼]\ní‡´ì›\n[í–¥í›„ê³„íš]\ní˜¸í¡ê³¤ë€ ì§„í–‰, ê°í˜ˆ ë“± ìˆìœ¼ë©´ ER ì¬ë‚´ì› êµìœ¡í•¨.\nì‚°ì†Œí¬í™”ë„ ì¸¡ì • ì˜ í•˜ì‹œë„ë¡í•¨."},{label:"ì»¨ì„¤íŠ¸ë‹µë³€",text:"1. ê·€ê³¼ì ìœ¼ë¡œ ì¶œí˜ˆì˜ ìœ„í—˜ì„± ë†’ì§€ ì•Šë‹¤ë©´, LMWH ë‹¨ê¸°ê°„ ìœ ì§€, ì¶”í›„ ê°ëŸ‰, ì¤‘ë‹¨ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ì´ì— ëŒ€í•´ì„œëŠ” ì¶”í›„ ì‹ ê²½ê³¼ ì™¸ë˜ë¡œ FU í•´ì£¼ì‹­ì‹œì˜¤.\n2. Sacral insufficiency fractureì— ëŒ€í•´ì„œëŠ” ì •í˜•ì™¸ê³¼ í˜‘ì§„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n3. ì‹ ê²½ê³¼ì ìœ¼ë¡œëŠ” LMWH íˆ¬ì•½ ìœ ì§€í•œë‹¤ë©´ aspirin íˆ¬ì•½ì„ ì§€ì†í•  ì´ìœ ëŠ” ì—†ì„ ê²ƒìœ¼ë¡œ íŒë‹¨í•©ë‹ˆë‹¤."},{label:"GSì…ì›+OP",text:"GS adm, NPO\nOP ë‚´ì¼ 1st"},{label:"CCUì…ì›",text:"CARD adm to CCU, CAG ì˜ˆì •\nlab/EKG í™•ì¸"},{label:"ì „ì›",text:"ì „ì›, 00ë³‘ì› NSë¡œ\nCT/MRI CD ë³µì‚¬ í•„ìš”"},{label:"ERCPì…ì›",text:"GI adm, ERCP ì‹œí–‰ ì˜ˆì •, NPO ìœ ì§€\nENDO OPD f/u 1ê°œì›”"}];

let activeTitle = null; // ê²€ìƒ‰ ëª¨ë“œìš© íƒ€ì´í‹€ ë³€ìˆ˜

let cl=[],cs={},cp=null,ci="";

// ==========================================
// [DOMAIN: DATA] ë³‘ì› ì—…ë¬´ ì§€ì¹¨ ë° ì‹œìˆ  ë°ì´í„°
// - PROCEDURE_DB: 26ê°œ ì‹œìˆ ë³„ prep/med/post/warning/transfer
// - GUIDE_DB: 39ê°œ ì—…ë¬´ê°€ì´ë“œ ì¹´í…Œê³ ë¦¬ë³„ í•­ëª©
// ==========================================

const PROCEDURE_DB = {
  "ERCP": {
    keywords: /ERCP|ì´ì•Œì”¨í”¼|ë‚´ì‹œê²½ì—­í–‰ë‹´ì·Œê´€ì¡°ì˜/i,
    prep: ["ì§„ì • ë‚´ì‹œê²½ì  ì—­í–‰ì„± ë‹´ì·Œê´€ ë°°ì•¡ìˆ  ë™ì˜ì„œ í™•ì¸", "NPO(ê¸ˆì‹) ìœ ì§€", "ë³´í˜¸ì ë™ë°˜ í•„ìˆ˜", "Pre-lab: CBC, PT/aPTT"],
    med: ["ì˜ˆë°©ì  í•­ìƒì œ í™•ì¸", "ì²« ERCP ì‹œ Futhan(Nafamostat) íˆ¬ì•½í• ì§€ í™•ì¸"],
    post: ["4hr Post-lab: Amy/Lip + Abd supine/erect í™•ì¸", "Abd pain ì‚¬ì •"],
    warning: ["âš ï¸ Pancreatitis ë°œìƒ ì£¼ì˜", "âš ï¸ Massive Hydration(Hartmann Sol) í•„ìš” ê°€ëŠ¥ì„±"],
    transfer: ["ì†Œí™”ê¸°ë‚´ì‹œê²½ì„¼í„° (â˜2574, 7266)"],
    important: true,
  },
  "EGD": {
    keywords: /\bEGD\b|ìœ„ë‚´ì‹œê²½|ìƒë¶€ë‚´ì‹œê²½|ê°€ìŠ¤íŠ¸ë¡œìŠ¤ì½”í”¼/i,
    prep: ["L-tube ìˆìœ¼ë©´ ì œê±°", "ìœ„ë‚´ì‹œê²½ ê²€ì‚¬ ë™ì˜ì„œ í™•ì¸", "ì¶œí˜ˆì‹œ ë‚´ì‹œê²½ì  ì§€í˜ˆìˆ (Hemostasis)/EVL ë™ì˜ì„œ í•„ìš”", "Pre-lab: CBC, PLT, PT/aPTT, ABO/Rh"],
    med: [],
    post: ["V/S ì²´í¬", "ì¶œí˜ˆ ì§•í›„ ê´€ì°°"],
    warning: [],
    transfer: ["ì†Œí™”ê¸°ë‚´ì‹œê²½ì„¼í„° (â˜2574, 7266)"],
    important: false,
  },
  "CFS": {
    keywords: /\bCFS\b|ëŒ€ì¥ë‚´ì‹œê²½|ì½œë¡œë…¸ìŠ¤ì½”í”¼/i,
    prep: ["ëŒ€ì¥ë‚´ì‹œê²½ê²€ì‚¬ ë™ì˜ì„œ", "Haprep íˆ¬ì—¬ í™•ì¸", "ì¥ì •ê²° í™•ì¸: #1 ì „ë‚ ì €ë… #2 ë‹¹ì¼ì•„ì¹¨"],
    med: [],
    post: ["V/S ì²´í¬", "Abd pain ì‚¬ì •"],
    warning: [],
    transfer: ["ì†Œí™”ê¸°ë‚´ì‹œê²½ì„¼í„° (â˜2574, 7266)"],
    important: false,
  },
  "SFS": {
    keywords: /\bSFS\b|sigmoidoscopy|ì—ìŠ¤ìê²°ì¥ë‚´ì‹œê²½/i,
    prep: ["ì—ìŠ¤ìê²°ì¥ë‚´ì‹œê²½ê²€ì‚¬ ë™ì˜ì„œ", "Leclean solution 1~2íšŒ ì¥ì •ê²° í™•ì¸"],
    med: [],
    post: ["V/S ì²´í¬", "Abd pain ì‚¬ì •"],
    warning: [],
    transfer: ["ì†Œí™”ê¸°ë‚´ì‹œê²½ì„¼í„° (â˜2574, 7266)"],
    important: false,
  },
  "CT": {
    keywords: /\bCT\b/i,
    prep: ["20G ì´ìƒ ì†ëª© ìœ„ Pressureline IV","ì¡°ì˜ì œ ì „ì²˜ì¹˜: Avil ë‹¤ ë“¤ì–´ê°„ í›„ 30min, ìŠ¤í…Œë¡œì´ë“œëŠ” 1hr í›„ ì´¬ì˜","ì „ì²˜ì¹˜ ì‹œì‘ ì „ CTì‹¤ ì „í™”í•´ì„œ íˆ¬ì•½ ì‹œê°„ í™•ì¸"],
    med: [],
    post: ["15ë¶„ í›„ ì˜ìƒë³‘ë™ë·°ì–´ í™•ì¸"],
    warning: ["CT angio+3D: TNI í™•ì¸ & HR>70 â†’ betaloc í›„ 30ë¶„ f/u"],
    transfer: ["ì‘ê¸‰CT (â˜3687)"],
    important: false,
  },
  "MRI": {
    keywords: /\bMRI\b/i,
    prep: ["20G ì´ìƒ ì†ëª© ìœ„ Pressureline IV","Sedation ì‹œ: midazolam #1 ì¶œë°œ ì‹œ IVS", "ì¤€ë¹„ë¬¼: O2, mask/nasal, ambu, O2 line, fitting mask", "ì´ì†¡ëª¨ë‹ˆí„° + ì „ë¬¸/ì¸í„´ ë™ë°˜"],
    med: [],
    post: ["Sedation í›„ ì˜ì‹/í˜¸í¡ í™•ì¸"],
    warning: [],
    transfer: ["ì‘ê¸‰ MRI (â˜7528)"],
    important: false,
  },
  "CAG": {
    keywords: /\bCAG\b|ì‹¬ë„ì|ê´€ìƒë™ë§¥ì¡°ì˜/i,
    prep: ["ì‹¬ë„ììˆ  ë™ì˜ì„œ (ë´‰í•©ê¸° í¬í•¨)", "CCU vs ë³‘ë™ í™•ì¸ â€” CCUë©´ ì…ì‹¤ë™ì˜ì„œ ì¶”ê°€", "Skin prep (ì‚¬íƒ€êµ¬ë‹ˆ) â†’ DPP â†’ Sandbag"],
    med: [],
    post: [],
    warning: [],
    transfer: ["ì‹¬í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2677)","ìœ„ê¸‰ìƒí™©ì•„ë‹ˆë©´ S-CARë¡œ ë°”ê¿”ì„œ ì´ì†¡"],
    important: false,
  },
  "BAE": {
    keywords: /\bBAE\b|ê¸°ê´€ì§€ë™ë§¥ìƒ‰ì „/i,
    prep: ["ë™ì˜ì„œ 2ê±´: ìƒ‰ì „ìˆ  + ë´‰í•©ê¸°", "Skin prep (ì‚¬íƒ€êµ¬ë‹ˆ) â†’ DPP â†’ Sandbag", "Foley ì—¬ë¶€ í™•ì¸"],
    med: [],
    post: ["ê²€ì‚¬ í›„ 4~8hr ABR(ì ˆëŒ€ì•ˆì •)"],
    warning: [],
    transfer: ["ë³¸ê´€ í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2257)"],
    important: false,
  },
  "Embolization": {
    keywords: /\bEMBO\b|ì¶œí˜ˆí™˜ììƒ‰ì „ìˆ |ì—ë©€/i,
    prep: ["ì¶œí˜ˆí™˜ì ìƒ‰ì „ìˆ  ë™ì˜ì„œ", "Skin prep (ì‚¬íƒ€êµ¬ë‹ˆ) â†’ DPP â†’ Sandbag", "Foley ì—¬ë¶€ í™•ì¸"],
    med: [],
    post: ["ê²€ì‚¬ í›„ 4~8hr ABR(ì ˆëŒ€ì•ˆì •)","ì²œìë¶€ìœ„ë´‰í•©ê¸° ì‚¬ìš©ì‹œ 1~2hr ABR(ì ˆëŒ€ì•ˆì •)"],
    warning: [],
    transfer: ["ë³¸ê´€ í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2257)"],
    important: false,
  },
  "PTBD": {
    keywords: /\bPTBD\b|ê²½í”¼ê²½ê°„ë‹´ì¦™ë°°ì•¡/i,
    prep: ["ê²½í”¼ê²½ê°„ë‹´ë„ë°°ì•¡ìˆ (PTBD) ë™ì˜ì„œ"],
    med: [],
    post: ["QOD dressing", "2ì£¼ 1ë²ˆ bile bag change", "ê²€ì²´ â†’ culture ì£¼ì¹˜ì˜ noti","ì–‡ì€ ì½”ë‹ˆì¹¼íŠœë¸Œ"],
    warning: [],
    transfer: ["ë³¸ê´€ í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2257)"],
    important: false,
  },
  "abdPCD": {
    keywords: /abd\s*PCD|ë³µë¶€\s*PCD|ê²½í”¼ì ë³µë¶€ë°°ì•¡|ê²½í”¼ì ë°°ì•¡/i,
    prep: ["ë³µë¶€ê²½í”¼ë°°ì•¡ìˆ  ë™ì˜ì„œ"],
    med: [],
    post: ["ê²€ì²´ btl â†’ culture ë‚˜ê°€ëŠ”ì§€ ì£¼ì¹˜ì˜ noti","ì–‡ì€ ì½”ë‹ˆì¹¼íŠœë¸Œ"],
    warning: [],
    transfer: ["ë³¸ê´€ í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2257)"],
    important: false,
  },
  "chestPCD": {
    keywords: /chest\s*PCD|í‰ë¶€\s*PCD|ê²½í”¼ì í‰ë¶€ë°°ì•¡|pigtail/i,
    prep: ["ê²½í”¼í‰ê´€ì‚½ê´€ìˆ  ë™ì˜ì„œ","Chest bottle ê±¸ì´, íˆ¬ì•½ì‹¤ì— ë„¤ì„ë¼ë²¨ ë¶™ì´ê¸°","í˜ˆì¡° ìš”ì²­ì‹œ chest bottle ëœ¯ì§€ë§ê³  ë³´ë‚´ê¸°"],
    med: [],
    post: [],
    warning: [],
    transfer: ["ì•”ë³‘ì› í˜ˆê´€ì¡°ì˜ì‹¤ (â˜7345)"],
    important: false,
  },
  "PCN": {
    keywords: /\bPCN\b|ê²½í”¼ì ì‹ ë£¨/i,
    prep: ["ê²½í”¼ì ì‹ ë£¨ ì„¤ì¹˜ìˆ  ë™ì˜ì„œ","ì¢Œìš° í™•ì¸ í•„ìˆ˜"],
    med: [],
    post: ["4hr ABR","QOD dressing"],
    warning: [],
    transfer: ["ì•”ë³‘ì› í˜ˆê´€ì¡°ì˜ì‹¤ (â˜7345)"],
    important: false,
  },
  "í™€í„°": {
    keywords: /í™€í„°|holter|24ì‹œê°„ì‹¬ì „ë„/i,
    prep: ["ê²€ì‚¬ ì „ ì–‡ì€ ëŸ°ë‹"],
    med: [],
    post: [],
    warning: ["ì •ê·œ: 24ì‹œê°„ ì‹¬ì „ë„ë°© ì˜ˆì•½ / ë¹„ì •ê·œ: 1588-5700 ì „í™” ì•ˆë‚´"],
    transfer: [""],
    important: false,
  },
  "EEG": {
    keywords: /\bEEG\b|ë‡ŒíŒŒ/i,
    prep: [],
    med: [],
    post: [],
    warning: ["ì •ê·œ: ìš°ë¦¬ê°€ ì˜ˆì•½ / ë¹„ì •ê·œ: 1588-5700 ì•ˆë‚´"],
    transfer: ["ë‡ŒíŒŒê²€ì‚¬ì‹¤ (â˜2572, 2579)"],
    important: false,
  },
  "Echo": {
    keywords: /\becho\b|ì‹¬ì´ˆìŒíŒŒ|ì‹¬ì—ì½”/i,
    prep: ["TTEë©´ ë™ì˜ì„œ í•„ìš”ì—†ìŒ","TEEë©´ ê²½ì‹ë„ì´ˆìŒíŒŒ ë™ì˜ì„œ"],
    med: [],
    post: [],
    warning: ["ì£¼ì¹˜ì˜ê°€ ì§ì ‘ ì˜ˆì•½","ì¸í„´ë„ê°€ëŠ¥"],
    transfer: ["ì‹¬ì¥ì´ˆìŒíŒŒì‹¤ (â˜2578)"],
    important: false,
  },
  "DJstent": {
    keywords: /\bDJ\b|DJ stent|ìš”ê´€ë¶€ëª©|ìš”ê´€ìŠ¤í…íŠ¸/i,
    prep: ["ì—­í–‰ì„± ì‹ ìš° ì¡°ì˜ìˆ  ë™ì˜ì„œ + ìš”ê´€ ë¶€ëª© ì„¤ì¹˜ìˆ  ë™ì˜ì„œ","NPO 4ì‹œê°„","IV í™•ë³´ (Gauge ìƒê´€ì—†ìŒ)","í•˜ì˜ ì†ì˜· íƒˆì˜","On call ì§„í†µì œ pethidine ë˜ëŠ” fentanyl mixed clamping"],
    med: [],
    post: ["V/S check","2hr ABR & supine â€” vasovagal syncope ìœ„í—˜ ë†’ìŒ","ì†Œë³€ ë°°ì¶œ ê´€ì°°"],
    warning: ["DJ êµí™˜ ì‹œ: ì—­í–‰ì„±ì‹ ìš°ì¡°ì˜ìˆ  + ìš”ê´€ë¶€ëª© êµì²´ìˆ  ë™ì˜ì„œ","DJ ì œê±° ì‹œ: ìš”ê´€ë¶€ëª© ì œê±°ìˆ  ë™ì˜ì„œë§Œ"],
    transfer: ["ëŒ€í•œì™¸ë˜ ì§€í•˜2ì¸µ ë°©ê´‘ê²½ì‹¤ (â˜2485)"],
    important: false,
  },
  "C-line": {
    keywords: /c-line|central line|ì¤‘ì‹¬ì •ë§¥ê´€|chemoport|hickman|\bPICC\b|\bIJC\b|perm cath/i,
    prep: ["ì¤‘ì‹¬ì •ë§¥ ë„ê´€ì‚½ì…ìˆ  ë™ì˜ì„œ (lumen ìˆ˜ ì£¼ì¹˜ì˜ í™•ì¸)","22G IV + Main fluid or KVO fluid (CIV ì‚¬ìš© ì¤‘ì´ë©´ ìƒˆ IV í•„ìš”)","ê¸ˆì‹ ì—†ìŒ (ì§„ì • ì‹œ: ê³ í˜• 6~8hr, ìœ ë™ì‹ 2~3hr)","1ë‹¬ ì´ë‚´ Lab í™•ì¸ (INR<2.0, PLT>2ë§Œ)","ìƒì˜ ì†ì˜· íƒˆì˜","Change/revision ì‹œ ì—°ê²° ìˆ˜ì•¡ ëª¨ë‘ ì œê±°"],
    med: [],
    post: ["V/S check","ì‚½ì…ë¶€ìœ„ oozing/bleeding ê´€ì°° (í•„ìš”ì‹œ sandbag ì••ë°•)","ì¤‘ì‹¬ì •ë§¥ê´€ ì›ìœ„ë¶€ ìœ„ì¹˜ ì£¼ì¹˜ì˜ í™•ì¸ í›„ ì‚¬ìš©","ì±„í˜ˆ ê°€ëŠ¥ ì—¬ë¶€ ì£¼ì¹˜ì˜ í™•ì¸"],
    warning: ["í˜ˆê´€ì¡°ì˜ì‹¤ ì™¸ ì‚½ì… ì‹œ Post CPA ì˜¤ë” í•„ìš”","íˆ¬ì„ìš© IJC: íˆ¬ì„/í˜ˆì¥êµí™˜ ì™¸ ì‚¬ìš© ê¸ˆê¸° (ì‘ê¸‰ ì œì™¸)"],
    transfer: ["ë³¸ì› í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2257)"],
    important: false,
  },
  "PEG": {
    keywords: /\bPEG\b|ê²½í”¼ì .*ìœ„ë£¨ìˆ |ìœ„ë£¨ìˆ /i,
    prep: ["ë‚´ì‹œê²½ì  ê²½í”¼ ìœ„ë£¨ìˆ  ë™ì˜ì„œ","MNNPO","18G IV + Main fluid or KVO fluid","Mouth opening í™•ì¸: 3cm ì´ìƒ (3ì†ê°€ë½)","L-tube ìˆìœ¼ë©´ ì œê±°í•˜ê³  ì´ì†¡"],
    med: ["Cefazolin 1g IV O.C (AST í™•ì¸ í›„)","Pethidine 25mg â€” ë‚´ì‹œê²½ì„¼í„°ì—ì„œ ì¤€ë¹„/íˆ¬ì•½"],
    post: ["V/S check","ì‹œìˆ  ë‹¤ìŒ ë‚  ì´ìƒ ì—†ìœ¼ë©´ ì‹ì´ ì‹œì‘","ê²½ê´€ì˜ì–‘ ì²˜ìŒ ì‹œì‘ ì‹œ NST consult","ì‚½ì…ë¶€ìœ„ 2ì£¼ê°„ ë§¤ì¼ ë² íƒ€ë”˜ ì†Œë… â†’ ì´í›„ 2ì¼ë§ˆë‹¤"],
    warning: [],
    transfer: ["ì†Œí™”ê¸°ë‚´ì‹œê²½ì„¼í„° (â˜2574, 7266)"],
    important: false,
  },
  "Cardioversion": {
    keywords: /cardioversion|ì¹´ë””ì˜¤ë²„ì „|ì „ê¸°ì .*ë™ìœ¨ë™|\bDCC\b|ë™ìœ¨ë™ì „í™˜/i,
    prep: ["ì „ê¸°ì  ë™ìœ¨ë™ ì „í™˜ ì‹œìˆ  ë™ì˜ì„œ","NPO 8ì‹œê°„","3way 2ê°œ ì¹´í…Œí„° ê°€ê¹Œì´ IV í™•ë³´","Etomidate prep, í–¥ì •ì´ë‹ˆ ì”ëŸ‰ í™•ì¸!"],
    med: [],
    post: ["V/S check","Post 12-lead ECG ì´¬ì˜, EKG monitoring ìœ ì§€","í‰ë¶€ í†µì¦, í”¼ë¶€ í™”ìƒ ê´€ì°°"],
    warning: ["í•©ë³‘ì¦: í”¼ë¶€í™”ìƒ, ë¶€ì •ë§¥, ìƒ‰ì „, ì €ì‚°ì†Œì¦, Etomidate ë¶€ì‘ìš©(ì „ì‹ tremor)"],
    transfer: [],
    important: false,
  },
  "Pacemaker": {
    keywords: /pacemaker|í˜ì´ìŠ¤ë©”ì´ì»¤|ì‹¬ë°•ë™ê¸°|\bPM\b.*ì‚½ì…|\bICD\b.*ì‚½ì…|\bCRT\b.*ì‚½ì…|\bILR\b/i,
    prep: ["ì¸ê³µì‹¬ë°•ë™ê¸° ì‹œìˆ ë™ì˜ì„œ","NPO 8ì‹œê°„","Cefazolin 1g AST ì‹œí–‰ â†’ ì‹œìˆ ì¥ì— cefazolin 1g 2ê°œ + d5w 50cc 1bag ë³´ë‚´ê¸°","í•­í˜ˆì†ŒíŒ/í•­ì‘ê³ ì œ ë³µìš© ì‹œ ì£¼ì¹˜ì˜ í™•ì¸","Complete AVB: ì–‘ìª½ ì„œí˜œë¶€ ì œëª¨ + DPP/SMC í™•ì¸","Sandbag 1ê°œ (Complete AVB: 2ê°œ)","ë³´í˜¸ì ë™ë°˜, í™˜ì˜ë§Œ (ì†ì˜· ì œê±°)"],
    med: ["Cefa AST(+) ì‹œ: Levofloxacin 750mg íˆ¬ì•½ + 250mg/50ml 1bag ë³´ë‚´ê¸°"],
    post: ["V/S check + EKG monitoring","4hr ABR + sandbag (í•­ì‘ê³ ì œ í™˜ì: 6~8hr, ILR: 2hr)","PM ëª¨ë“œ/íšŸìˆ˜ í™•ì¸ (ì‹¬í˜ˆê´€ì„¼í„° ì¸ê³„)","ê³¼ë„í•œ íŒ”ìš´ë™ ì œí•œ"],
    warning: ["HIS Alert â†’ MRI ê¸ˆê¸° ì¥ì¹˜ â†’ Pacemaker ì²´í¬"],
    transfer: ["3ì¸µ ì‹¬í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2677)"],
    important: false,
  },
  "PTGBD": {
    keywords: /\bPTGBD\b|ê²½í”¼ì .*ë‹´ë‚­ë°°ì•¡|ë‹´ë‚­ë°°ì•¡/i,
    prep: ["ê²½í”¼ê²½ê°„ ë‹´ë‚­ë°°ì•¡ìˆ  ë™ì˜ì„œ","NPO 4ì‹œê°„ (ì§„ì • ì‹œ: ê³ í˜• 6~8hr, ìœ ë™ì‹ 2~3hr)","22G IV + Main fluid","ìƒì˜ ì†ì˜· íƒˆì˜"],
    med: [],
    post: ["V/S check","í†µì¦ ì‚¬ì • ë° ì¡°ì ˆ","ë°°ì•¡ê´€ ë°°ì•¡ì–‘ìƒ/ë°°ì•¡ëŸ‰ ê´€ì°°"],
    warning: [],
    transfer: ["ë³¸ì› 1ì¸µ í˜ˆê´€ì¡°ì˜ì‹¤ (â˜2257)"],
    important: false,
  },
  "OP": {
    keywords: /\bOP\b|ìˆ˜ìˆ |ì‘ê¸‰ìˆ˜ìˆ |emergency op/i,
    prep: [
      "ìˆ˜ìˆ  ì „ Anti íˆ¬ì—¬ í™•ì¸ (Antibiotics)",
      "ì…ì›ìë¦¬ í™•ì¸ í›„ ìˆ˜ì†",
      "ìˆ˜ìˆ  ì „ ê°„í˜¸ê¸°ë¡ ì‘ì„±",
      "ì „ê³¼ì „ë™ê¸°ë¡ì§€ ì‘ì„± (ì…ì›ë³‘ë™ìš©)",
      "Foley ì‚½ì… ì—¬ë¶€ ì£¼ì¹˜ì˜ í™•ì¸",
      "ìˆ˜ìˆ ë™ì˜ì„œ í™•ì¸ â€” ìˆ˜ìˆ /ë§ˆì·¨ë™ì˜ì„œëŠ” í•´ë‹¹ê³¼ì—ì„œ ë°›ìŒ, ERì—ì„œëŠ” ìˆ˜í˜ˆë™ì˜ì„œê¹Œì§€ë§Œ",
    ],
    med: ["ìˆ˜ìˆ  ì „ Antibiotics íˆ¬ì—¬ ì‹œê°„ í™•ì¸"],
    post: [],
    warning: ["âš ï¸ S-carì— ëˆ•í˜€ì„œ ì´ì†¡", "âš ï¸ ë³‘ë™ì¸ê³„ í›„ ì´ì†¡ë³´ë‚¸ ì‹œê°„ì— ì´ë¦„ë¹¼ê¸°"],
    transfer: [""],
    important: false,
  },
  "Stroke": {
    keywords: /stroke|ë‡Œì¡¸ì¤‘|SU|Stroke Unit|\bSU\b/i,
    prep: ["ë‡Œì¡¸ì¤‘ì§‘ì¤‘ì¹˜ë£Œì‹¤ ì…ì‹¤ ë™ì˜ì„œ í™•ì¸"],
    med: ["DAPT íˆ¬ì—¬ ìŠ¤ì¼€ì¤„ í™•ì¸"],
    post: ["104Wì— ìë¦¬í™•ì¸"],
    warning: ["âš ï¸ Neurological change ë°œìƒ ì‹œ ì¦‰ì‹œ ë³´ê³ ", "âš ï¸ ë‚™ìƒ ê³ ìœ„í—˜êµ° ê´€ë¦¬"],
    transfer: ["ë‡Œì¡¸ì¤‘ ì§‘ì¤‘ì¹˜ë£Œì‹¤ (â˜ 0309)"],
    important: false,
  },
 "ë³µìˆ˜ì²œì": {
  keywords: /paracentesis|ë³µìˆ˜\s*ì²œì|abd\s*tap|\bA\/T\b|ascites\s*tapping/i,
  prep: ["Hb, PLT, INR í™•ì¸", "ë³µìˆ˜ì²œììˆ  ë™ì˜ì„œ", "Max drain ì–‘ ì£¼ì¹˜ì˜ confirm", "3L ì´ìƒ ì‹œ Albumin replace ì˜¤ë” í™•ì¸ (5L ì´ìƒ ì‹œ í•„ìˆ˜)"],
  med: [],
  post: ["ë‚¨ì€ ê²€ì²´(ì´ë¦„, ë‚ ì§œ, ì‹œê°„, ë¶€ìœ„) ì‹¤ë³´/ëƒ‰ë³´/íê¸° ì£¼ì¹˜ì˜ í™•ì¸"],
  warning: ["drain ì•ˆ ë‚˜ì˜¤ë©´ ì²´ìœ„ë³€ê²½, ì‹¬í˜¸í¡ ê²©ë ¤ 10ë¶„ ëŒ€ê¸° í›„ ì£¼ì¹˜ì˜ í™•ì¸ í›„ removal"],
  transfer: [""],
  important: false,
},
"ìš”ì¶”ì²œì": {
  keywords: /\bLP\b|lumbar\s*puncture|ìš”ì¶”\s*ì²œì|\bS\/T\b|spinal\s*tapping/i,
  prep: ["bedsideì‹œ ì„±ì¸ ì²™ì¶” ì²œì ë™ì˜ì„œ, ì‹œìˆ ì‹¤ì´ë©´ ì˜ìƒìœ ë„í•˜ ì²™ì¶”ì²œì ë™ì˜ì„œ", "ìë¦¬ ë°›ê¸°","ì²œì ì „ BST check"],
  med: [],
  post: ["ì‹¤ì˜¨ë³´ê´€ ëƒ‰ì¥ë³´ê´€ í™•ì¸ (ì´ë¦„, ë‚ ì§œ, ì‹œê°„, ë¶€ìœ„)", "4hr ABR (flat position)", "ë‘í†µ ì‚¬ì • (post-LP headache)"],
  warning: [],
  transfer: [""],
  important: false,
},
"í‰ìˆ˜ì²œì": {
  keywords: /thoracentesis|í‰ìˆ˜\s*ì²œì|\bP\/T\b|pleural\s*tapping/i,
  prep: ["Hb, PLT, INR í™•ì¸", "í‰ìˆ˜ì²œììˆ  ë™ì˜ì„œ (ì¢Œìš° í™•ì¸ í•„ìˆ˜)", "Max drain ì–‘ ì£¼ì¹˜ì˜ confirm (ë³´í†µ 1~1.5L)"],
  med: [],
  post: ["Post chest X-ray í™•ì¸", "ë‚¨ì€ ê²€ì²´(ì´ë¦„, ë‚ ì§œ, ì‹œê°„, ë¶€ìœ„) ì‹¤ë³´/ëƒ‰ë³´/íê¸° ì£¼ì¹˜ì˜ í™•ì¸"],
  warning: ["drain ì•ˆ ë‚˜ì˜¤ë©´ ì²´ìœ„ë³€ê²½, ì‹¬í˜¸í¡ ê²©ë ¤ 10ë¶„ ëŒ€ê¸° í›„ ì£¼ì¹˜ì˜ í™•ì¸ í›„ removal"],
  transfer: [""],
  important: false,
},
  "PCC": {
    keywords: /\bPCC\b|ì‹¬ë‚­ì²œì|pericardiocentesis/i,
    prep: ["ì‹¬ë‚­ì²œììˆ  ë™ì˜ì„œ","ë³´í†µ ì†Œìƒì‹¤ì—ì„œ ì‹œí–‰ â€” ì£¼ì„ì„ ìƒë‹˜ê»˜ ë³´ê³ ","PCC set ì½œ"],
    med: [],
    post: ["PCC bag ë¹„ìš°ì§€ ë§ê³  bag ìì²´ë¥¼ êµì²´"],
    warning: [],
    transfer: [""],
    important: false,
  },
};

// ========== ì—…ë¬´ ê°€ì´ë“œ DB ==========
const GUIDE_DB = {
  "ICU": {
    keywords: /\bICU\b|ì¤‘í™˜ìì‹¤/i,
    icon: "ğŸ¥",
    items: [
      {cat:"ë™ì˜ì„œ",txt:"ì¤‘í™˜ìì‹¤ì…ì‹¤ë™ì˜ì„œ í•„ìš”"},
    ]
  },
  "CCU": {
    keywords: /\bCCU\b|ì‹¬í˜ˆê´€.*ì¤‘í™˜ì/i,
    icon: "ğŸ¥",
    items: [
      {cat:"ë™ì˜ì„œ",txt:"ì‹¬í˜ˆê´€ë‚´ê³¼ì¤‘í™˜ìì‹¤ ì…ì‹¤ë™ì˜ì„œ í•„ìš”"},
    ]
  },
  "Stroke": {
    keywords: /stroke.*unit|ë‡Œì¡¸ì¤‘ì§‘ì¤‘/i,
    icon: "ğŸ¥",
    items: [
      {cat:"ë™ì˜ì„œ",txt:"ë‡Œì¡¸ì¤‘ì§‘ì¤‘ì¹˜ë£Œì‹¤ë™ì˜ì„œ í•„ìš”"},
      {cat:"ì•ˆë‚´",txt:"ë³´í˜¸ì 24hr 1ì¸ ìƒì£¼ í•„ìˆ˜ â˜0309"},
    ]
  },
  "LICU": {
    keywords: /\bLICU\b|ê°„ì§‘ì¤‘ì¹˜ë£Œì‹¤/i,
    icon: "ğŸ¥",
    items: [
      {cat:"ë™ì˜ì„œ",txt:"ê°„ì§‘ì¤‘ì¹˜ë£Œì‹¤ì…ì‹¤ë™ì˜ì„œ í•„ìš”"},
      {cat:"ì•ˆë‚´",txt:"ë³´í˜¸ì 24hr 1ì¸ ìƒì£¼ í•„ìˆ˜"},
      {cat:"ì•ˆë‚´",txt:"114ë³‘ë™ ì†Œì† â˜2670"},
    ]
  },
  "ìˆ˜í˜ˆ": {
    keywords: /ìˆ˜í˜ˆ|transfusion|\bRBC\b|\bFFP\b|pheresis|\bPLT Tf\b|\bpRBC\b|í˜ˆì•¡ì œì œ/i,
    icon: "ğŸ©¸",
    items: [
      {cat:"ì¤€ë¹„",txt:"ìˆ˜í˜ˆë™ì˜ì„œ í™•ì¸"},
      {cat:"ì¤€ë¹„",txt:"êµ¬ì¡°ì‚¬ call: ABO sample + ìˆ˜í˜ˆ line ë¶€íƒë“œë¦½ë‹ˆë‹¤"},
      {cat:"ì¤€ë¹„",txt:"ABO ì˜¤ë”: í™˜ìëª… ì˜† í˜ˆì•¡í˜• ìˆìœ¼ë©´ 1ê°œ, ì—†ìœ¼ë©´ 2ê°œ (3ì¼ë§ˆë‹¤ ì±„í˜ˆ)"},
      {cat:"ì¤€ë¹„",txt:"ìˆ˜í˜ˆ ì‹œ MF hold ì—¬ë¶€ ì£¼ì¹˜ì˜ í™•ì¸"},
      {cat:"ì°¸ê³ ",txt:"FFP: 30ë¶„~1ì‹œê°„, 180ml / INR êµì • or Volume"},
      {cat:"ì°¸ê³ ",txt:"Pheresis(PLT): 30ë¶„~1ì‹œê°„ / PLT ì €í•˜ ì‹œ"},
      {cat:"ì°¸ê³ ",txt:"RBC: 2~4ì‹œê°„, 400ml or 320ml / Hb ì €í•˜ ì‹œ"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ ë‚¨ì€ ìˆ˜í˜ˆ ë³‘ë™ì¸ê³„ ì‹œ: ER ì˜¤ë” ìœ ì§€ ì—¬ë¶€ í™•ì¸"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ íê¸°/ë°˜ë‚© ì‹œ: ìš”ì²­ì„œ(íˆ¬ì•½ì‹¤) ì£¼ì¹˜ì˜ ì‚¬ì¸ â†’ NAë‹˜ ì „ë‹¬"},
    ]
  },
  "ë§ˆì•½ë°˜ë‚©": {
    keywords: /ë§ˆì•½.*ë°˜ë‚©|ë§ˆì•½ë°˜ë‚©|narcotic|ë§ˆì•½ê´€ë¦¬/i,
    icon: "ğŸ’Š",
    items: [
      {cat:"ì ˆì°¨",txt:"mix ì•ˆ í•˜ê³  ë°˜ë‚©: Eì‚¬ì¸ ë„£ì–´ì„œ ë³´ë¼ìƒ‰ ì—†ì• ê¸°"},
      {cat:"ì ˆì°¨",txt:"mix í›„ ë°˜ë‚©: ë§ˆì•½ì¥ì— ë„£ê³  Xì‚¬ì¸"},
      {cat:"ì ˆì°¨",txt:"ë§ˆì•½í˜„í™©ì¡°íšŒ â†’ ì•½ë¬¼ì¡°íšŒ â†’ ë°˜ë‚©ëŸ‰/ì‚¬ìœ  ì…ë ¥ â†’ ë°˜ë‚©ë‚´ì—­ ì¶œë ¥"},
      {cat:"ì ˆì°¨",txt:"'ë§ˆì•½ë°˜ë‚©ë‚´ì—­ ì¶œë ¥ì§€' + í™˜ìì•½ í•¨ê»˜ 60ë²ˆ NAë‹˜ê»˜ ì „ë‹¬"},
    ]
  },
  "enema": {
    keywords: /enema|ì—ë„¤ë§ˆ|ê´€ì¥|kalimate|duphalac|lactulose|ê¸€ë¦¬ì„¸ë¦°|glycerin|leclean/i,
    icon: "ğŸ’§",
    items: [
      {cat:"ì¤€ë¹„",txt:"ì°ì°ì´ ê¸°ì €ê·€(íŒ¬í‹°í˜• ì ˆëŒ€ ì•ˆë¨) + ë¬¼í‹°ìŠˆ ë¯¸ë¦¬ ì•ˆë‚´ â†’ ê¸°ì €ê·€ ì±„ì›Œë†“ê¸°"},
      {cat:"Kalimate",txt:"Kalimate 5gÃ—6í¬ + D5W 200ml â†’ 15ë¶„ ì´ìƒ ì°¸ìœ¼ë¼ê³  ì„¤ëª…"},
      {cat:"Duphalac",txt:"Lactulose 200ml [ê°„ì„±í˜¼ìˆ˜ìš©] â€” 50cc syringe + rectal tube + ìœ¤í™œì œ + íœ´ì§€"},
      {cat:"Leclean",txt:"Leclean & Glycerin: ì™„ì œí’ˆ (ë¹„í’ˆ ìˆìŒ) / ìˆ˜ê°€: ê¸€ë¦¬ì„¸ë¦° ê´€ì¥ or drug retention enema"},
    ]
  },
  "CIV": {
    keywords: /\bCIV\b|ì§€ì†ì£¼ì…|continuous.*infusion|ë…¸ì—í”¼|ë‹ˆì¹´ë””í•€|ë‹ˆíŠ¸ë¡œ|íŒí† í”„ë¼ì¡¸/i,
    icon: "ğŸ’‰",
    items: [
      {cat:"ì²˜ë°©",txt:"â‘  NE(Norepinephrine) 4mcg/min = 15cc/hr â€” NE 3.2mg + D5W 196.8ml (total 200ml)"},
      {cat:"ì²˜ë°©",txt:"â‘¡ NCD(Nicardipine) 1mg/hr = 5cc/hr â€” NCD 50mg + NS 200ml (total 250ml)"},
      {cat:"ì²˜ë°©",txt:"â‘¢ NG(Nitroglycerin) 10mcg/min = 3cc/hr â€” NG 20mg + D5W 80ml (total 100ml)"},
      {cat:"ì²˜ë°©",txt:"â‘£ PPI(Pantoprazole/Nexium) 8mg/hr = 8cc/hr â€” PPI 80mg + NS 80ml (total 80ml)"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ CIV ì•½ë¬¼ì€ ë‹¨ë… line ì‚¬ìš© (PPIëŠ” MFì— ë³‘ìš© ê°€ëŠ¥)"},
    ]
  },
  "ê³ ì¹¼ë¥¨": {
    keywords: /ê³ ì¹¼ë¥¨|hyperkalemia|K\+.*ë†’|ì¹¼ë¥¨.*ë†’|potassium.*high|Kêµì •/i,
    icon: "âš¡",
    items: [
      {cat:"íˆ¬ì•½",txt:"Calcium gluconate IV"},
      {cat:"íˆ¬ì•½",txt:"D50% + Humulin R IV"},
      {cat:"íˆ¬ì•½",txt:"30min / 1hr BST f/u"},
      {cat:"íˆ¬ì•½",txt:"Kalimate enema ë³‘í–‰ ê°€ëŠ¥"},
      ]
  },
  "mixê¸ˆê¸°": {
    keywords: /mix.*ê¸ˆê¸°|ë°°í•©ê¸ˆê¸°|í˜¼í•©ê¸ˆê¸°|ì¹¨ì „|ê°™ì€.*ë¼ì¸/i,
    icon: "ğŸš«",
    items: [
      {cat:"ê¸ˆê¸°",txt:"â˜… ê°™ì€ ë¼ì¸ mix ê¸ˆì§€ â€” ëª¨ë¥´ëŠ” ì•½ì€ ë”ë¸”í´ë¦­í•´ì„œ ì•½í’ˆì •ë³´ì¡°íšŒ í™•ì¸ â˜…"},
      {cat:"ê¸ˆê¸°",txt:"Phosten(KH2PO4) + MgSO4 â†’ ì¹¨ì „ë¬¼ ìƒê¹€ / íˆ¬ì•½ìˆœì„œ: Mg â†’ Ca â†’ Phosten"},
      {cat:"ê¸ˆê¸°",txt:"Bivon(Bicarbonate sodium) + Calciumì œì œ â†’ í¬ë¦¬ìŠ¤íƒˆ ìƒê¹€"},
      {cat:"ê¸ˆê¸°",txt:"TPN + Triaxone â†’ ì¹¼ìŠ˜í•¨ìœ ìš©ì•¡ ë™ì‹œíˆ¬ì—¬ ë¶ˆê°€ (ì¹¨ì „ìœ„í—˜)"},
    ]
  },
  "íˆ¬ì•½ì†ë„": {
    keywords: /íˆ¬ì•½.*ì†ë„|ìˆ˜ì•¡.*ì†ë„|drip.*rate|ë°©ìš¸|cc\/hr/i,
    icon: "â±ï¸",
    items: [
      {cat:"ì†ë„",txt:"40cc/hr = 3~4ì´ˆì— 1ë°©ìš¸ = 24ì‹œê°„"},
      {cat:"ì†ë„",txt:"80cc/hr = 2~3ì´ˆì— 1ë°©ìš¸ = 12ì‹œê°„"},
      {cat:"ì†ë„",txt:"120cc/hr = 1~2ì´ˆì— 1ë°©ìš¸ = 8~9ì‹œê°„"},
      {cat:"ì°¸ê³ ",txt:"[SUP] = Yì‚¬ì¸ ë„£ì„ ë•Œë§ˆë‹¤ ì˜¬ë¼ì˜´ / [TIT] ì²­êµ¬ â†’ íˆ¬ì•½ ì‹œ Yì‚¬ì¸"},
    ]
  },
  "TDM": {
    keywords: /\bTDM\b|ì•½ë¬¼ë†ë„|digoxin|vanco|í•­ê²½ë ¨ì œ|ë©´ì—­ì–µì œì œ/i,
    icon: "ğŸ”¬",
    items: [
      {cat:"ëŒ€ìƒ",txt:"Digoxin, Vancomycin, í•­ê²½ë ¨ì œ, ë©´ì—­ì–µì œì œ"},
      {cat:"ì‹œì ",txt:"ë³´í†µ ì•½ ë¨¹ê¸° 30min ì „ ì±„í˜ˆ (ERì—ì„œëŠ” ë¨¹ì–´ë„ ë‚˜ê°ˆ ë•Œ ìˆìŒ)"},
    ]
  },
  "ACTH": {
    keywords: /\bACTH\b|synacthen|ì‹œë‚™í…|ì½”í‹°ì†”|cortisol.*test/i,
    icon: "ğŸ§ª",
    items: [
      {cat:"ì ˆì°¨",txt:"ACTH ê²€ì‚¬ ì˜¤ë” â†’ êµ¬ì¡°ì‚¬ call: ACTH ê²€ì‚¬ ë‚˜ê°€ì£¼ì„¸ìš”"},
      {cat:"ì ˆì°¨",txt:"êµ¬ì¡°ì‚¬ê°€ ACTH + Cortisol(basal) ì±„í˜ˆ"},
      {cat:"ì ˆì°¨",txt:"Synacthen IV shooting â†’ í¬ì‹œë¡œ ë°€ì–´ì£¼ê¸°"},
      {cat:"ì ˆì°¨",txt:"30min í›„ Cortisol ì±„í˜ˆ â†’ 60min í›„ Cortisol ì±„í˜ˆ"},
      {cat:"ì°¸ê³ ",txt:"ACTH stimulation test ê²€ì‚¬ì˜¤ë”ëŠ” ì´ˆê¸°ìƒíƒœê°€ ë§ìŒ (ìˆ˜ê°€ ì—†ìŒ)"},
    ]
  },
  "íˆ¬ì„": {
    keywords: /íˆ¬ì„|dialysis|HD|í˜ˆì•¡íˆ¬ì„|\bperm cath\b|ì¸ê³µì‹ ì¥/i,
    icon: "ğŸ«§",
    items: [
      {cat:"ë™ì˜ì„œ",txt:"Perm cath ì‚½ì…ì‹œìˆ  ë™ì˜ì„œ + ì‘ê¸‰í˜ˆì•¡íˆ¬ì„ì‹œìˆ ë™ì˜ì„œ (PTA ê²½í”¼ê²½í˜ˆê´€ì„±í˜•ìˆ )"},
      {cat:"ì ì‘ì¦",txt:"AVF malfunctionì´ê±°ë‚˜ ì—†ëŠ” ì‚¬ëŒ â†’ ì‘ê¸‰íˆ¬ì„"},
      {cat:"ì´ì†¡",txt:"í˜ˆê´€ì¡°ì˜ì‹¤ â†’ X-rayì‹¤ â†’ íˆ¬ì„(ì¸ê³µì‹ ì¥ì‹¤) ì´ì†¡ë“±ë¡"},
      {cat:"í™•ì¸",txt:"íˆ¬ì„ì‹¤ ì „í™”: perm ê½‚ìœ¼ëŸ¬ ê°€ëŠ”ë° XR ì°ê³  ë°”ë¡œ íˆ¬ì„ ê°€ë„ ë˜ëŠ”ì§€"},
      {cat:"í™•ì¸",txt:"Post XR confirm: ì‹ ì¥ë‚´ê³¼ ì „ì„ì˜"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ íˆ¬ì„ ëª»í•˜ë©´ K+ level â–²"},
    ]
  },
  "A-line": {
    keywords: /a-line|art.*line|ë™ë§¥ë¼ì¸|ë™ë§¥ê´€|ì—ì´ë¼ì¸/i,
    icon: "ğŸ“ˆ",
    items: [
      {cat:"ì¤€ë¹„",txt:"ìˆ˜ê°€: transducer + cannular + ë‚˜í”½ìŠ¤ + ë™ë§¥í˜ˆì••ì¸¡ì •"},
      {cat:"ìœ„ì¹˜",txt:"A-line ì¹´í…Œí„°, ë‚˜í”½ìŠ¤: ì†Œìƒì‹¤"},
      {cat:"ìœ„ì¹˜",txt:"Pressure bag: ì†Œìƒì‹¤"},
      {cat:"ìœ„ì¹˜",txt:"ì§‘ê²Œ, ì»¤ë„¥í„°: ì†Œìƒì‹¤"},
    ]
  },
  "ì‹ í™˜ì ‘ìˆ˜": {
    keywords: /ì‹ í™˜|ì‹ ê·œí™˜ì|ìƒˆí™˜ì|ëŒ€ê¸°ì‹¤.*í™˜ì|ìë¦¬.*ë°›ì€/i,
    icon: "ğŸ†•",
    items: [
      {cat:"ëŒ€ê¸°ì‹¤",txt:"â‘  ì˜¤ë” screening, ì²˜ì¹˜ ëŠê¸° (ì˜ˆì§„ì‹¤ IV set â†’ IV í™•ë³´ + ìˆ˜ì•¡ ì—°ê²°)"},
      {cat:"ëŒ€ê¸°ì‹¤",txt:"â‘¡ X-ray/CT/MRI ìˆìœ¼ë©´ í™˜ìë³µ ë“¤ê³ ê°€ê¸° (ì¤‘ìÂ·ëŒ€ì 3êµ¬ì—­ ì˜·ì¥)"},
      {cat:"ëŒ€ê¸°ì‹¤",txt:"â‘¢ ì±„í˜ˆ, X-ray, ê¸ˆì‹, ë³´í˜¸ì ìƒì£¼ ì›ì¹™ ì„¤ëª…"},
      {cat:"ëŒ€ê¸°ì‹¤",txt:"â‘£ í™˜ì ì‚¬ì •, V/S check"},
      {cat:"ëŒ€ê¸°ì‹¤",txt:"â‘¤ ë‹´ë‹¹ê°„í˜¸ì‚¬ êµ¬ì—­ ì•ˆë‚´ (ì•ˆë‚´ ì•ˆí•˜ë©´ ì˜ˆì§„ì‹¤ ì—…ë¬´ ë§ˆë¹„)"},
      {cat:"ìë¦¬ë°°ì •",txt:"â‘  ì˜¤ë” screening, ì£¼ì¦ìƒ, ê³¼ê±°ë ¥ í™•ì¸ ë° ì²˜ì¹˜ ëŠê¸°"},
      {cat:"ìë¦¬ë°°ì •",txt:"â‘¡ monitoring set, í™˜ìë³µ ì¤€ë¹„"},
      {cat:"ìë¦¬ë°°ì •",txt:"â‘¢ initial lab, CT, X-ray[p], MRI ë“± call (0026/0099), ì˜ìƒë³‘ë™ë·°ì–´, ë™ì˜ì„œ"},
      {cat:"ìë¦¬ë°°ì •",txt:"â‘£ í™˜ì ì‚¬ì •, monitor admit, V/S check"},
      {cat:"ìë¦¬ë°°ì •",txt:"â‘¤ ê¸ˆì‹, ë³´í˜¸ì ìƒì£¼ ì›ì¹™ ì„¤ëª…"},
    ]
  },
  "ê°„í˜¸ê¸°ë¡": {
    keywords: /ê°„í˜¸ê¸°ë¡|GCS|ì‚¬ì§€ê·¼ë ¥|pupil|NPI|ì˜ì‹ìˆ˜ì¤€/i,
    icon: "ğŸ“",
    items: [
      {cat:"GCS-E",txt:"E4 ìë°œì  ëˆˆëœ¸ / E3 ì†Œë¦¬ì— / E2 í†µì¦ì— / E1 ëˆˆëœ¨ì§€ ì•ŠìŒ"},
      {cat:"GCS-V",txt:"V5 ì§€ë‚¨ë ¥3+ / V4 ì§€ë‚¨ë ¥ í•˜ë‚˜ë¼ë„- / V3 í˜¼ë€ / V2 ì‹ ìŒ / V1 ë°œí™”ì—†ìŒ (ê¸°ê´€ì ˆê°œÂ·ì‚½ê´€ ì‹œ T)"},
      {cat:"GCS-M",txt:"M6 obey / M5 í†µì¦ ì ê·¹íšŒí”¼ / M4 ì†Œê·¹íšŒí”¼ / M3 ì´ìƒêµ´ê³¡ / M2 ì´ìƒì‹ ì „ / M1 ë¬´ë°˜ì‘"},
      {cat:"ê·¼ë ¥",txt:"V: ì •ìƒ(ì¤‘ë ¥+ê²€ì‚¬ì ì €í•­) / IV: ì•½ê°„ ì €í•­ / III: ë“¤ì–´ì˜¬ë¦¬ë‚˜ ëª»ë²„íŒ€ / II: ì¢Œìš°ë§Œ / I: ì›€ì°” / O: ì—†ìŒ"},
      {cat:"Pupil",txt:"ë¹›ë°˜ì‚¬: prompt / hippus / sluggish / ì—†ìŒ â€” NPIê¸°ê³„ ì†Œìƒì‹¤ ìœ„ì¹˜, NPIâ‰¥3ì´ë©´ prompt"},
      {cat:"ê¸°ë¡",txt:"íƒ€ì› foley/PTBD/PCN/L-tube/C-line â†’ ì‚½ì…ì¼ì, êµí™˜ì£¼ê¸°, ë“œë ˆì‹±ì¼ì í™•ì¸ í›„ ê¸°ë¡"},
    ]
  },
  "ê°„í˜¸ì§„ë‹¨": {
    keywords: /ê°„í˜¸ì§„ë‹¨|nursing.*diagnosis/i,
    icon: "ğŸ“‹",
    items: [
      {cat:"ì§„ë‹¨",txt:"ì¶œí˜ˆìœ„í—˜ / ì¶œí˜ˆ"},
      {cat:"ì§„ë‹¨",txt:"ë¹„íš¨ìœ¨ì  í˜¸í¡ ì–‘ìƒ"},
      {cat:"ì§„ë‹¨",txt:"ì¡°ì§ê´€ë¥˜ ì €í•˜: ë‡Œ, ì‹¬íê³„, ì‹ ì¥ ë“±"},
      {cat:"ì§„ë‹¨",txt:"ì¥íìƒ‰ì¦ / ê³ ì¹¼ë¥¨í˜ˆì¦ / ì €ë‚˜íŠ¸ë¥¨í˜ˆì¦"},
      {cat:"ì§„ë‹¨",txt:"ê¸‰ì„± í†µì¦"},
      {cat:"ì§„ë‹¨",txt:"ê°ì—¼ ìœ„í—˜ (CRPâ†‘, ë°œì—´)"},
      {cat:"ì§„ë‹¨",txt:"ì „ì—¼ ìœ„í—˜ (Flu, Covid, TB ë“±)"},
    ]
  },
  "ë“œë ˆì‹±ì£¼ê¸°": {
    keywords: /ë“œë ˆì‹±|dressing|êµí™˜ì£¼ê¸°|medress|tegaderm|L-tube.*ì£¼ê¸°/i,
    icon: "ğŸ©¹",
    items: [
      {cat:"ì£¼ê¸°",txt:"Medress: 2ì¼ë§ˆë‹¤"},
      {cat:"ì£¼ê¸°",txt:"Tegaderm: 1ì£¼ì¼ë§ˆë‹¤"},
      {cat:"ì£¼ê¸°",txt:"L-tube: 4ì£¼ë§ˆë‹¤"},
      {cat:"ì£¼ê¸°",txt:"C-line: ì•ˆ ì“¸ ê²½ìš° lumenë§ˆë‹¤ regurge/push í™•ì¸ â†’ heparin locking"},
    ]
  },
  "I/O": {
    keywords: /\bI\/O\b|ì¸ì•„ì›ƒ|intake.*output|ì†Œë³€ëŸ‰|urine.*output/i,
    icon: "ğŸ“Š",
    items: [
      {cat:"ì‹œê°„",txt:"q6h: 06:00, 12:00, 18:00, 23:59"},
      {cat:"ì‹œê°„",txt:"q8h: 08:00, 16:00, 23:59"},
      {cat:"ê¸°ë¡",txt:"Night 00:00ì— 23:59 ê¸°ë¡ê³¼ ë™ì¼í•˜ê²Œ í•œë²ˆ ë” ê¸°ë¡"},
      {cat:"ê¸°ë¡",txt:"ì„ìƒê´€ì°°ê¸°ë¡: ì „ë‚  23:59 & ë‹¹ì¼ 00:00 fluidì–‘ ê¸°ë¡, ì¸í“¨ì „íŒí”„ ì œë¡œì‰"},
      {cat:"ë²”ìœ„",txt:"-500~+500 ì •ìƒë²”ìœ„ / HFí™˜ìë‚˜ ì˜µì„¸ í™˜ìëŠ” ë‹¤ noti"},
      {cat:"ì£¼ì˜",txt:"I/O ì˜¤ë” ìˆëŠ”ë° foley ì—†ìœ¼ë©´ â†’ self ì²´í¬í• ê±´ì§€ ì£¼ì¹˜ì˜ í™•ì¸"},
      {cat:"ì£¼ì˜",txt:"F/D í™˜ì: drip í¬í•¨í•´ì„œ I/O noti / UO ì ì€ í™˜ì: ì‹œê°„ë‹¹ ì•Œë ¤ì£¼ê¸°"},
    ]
  },
  "ì•½ë°˜ë‚©": {
    keywords: /ì•½.*ë°˜ë‚©|ë°˜ë‚©.*ì•½|ë‚¨ì€ì•½|í‡´ì›ì•½.*ë°˜ë‚©/i,
    icon: "â†©ï¸",
    items: [
      {cat:"ë°˜ë‚©",txt:"ì´ë¯¸ ì˜¬ë¼ì˜¨ ì•½: 'ë°˜ë‚©ìš©ì§€' + ì•½ â†’ ì†Œë…ë¬¼ì‹¤ + 60ë²ˆ ì‚ë¡"},
      {cat:"ë°˜ë‚©",txt:"ì ‘ìˆ˜ë§Œ ëœ ì•½: 82)2592 or 2977 ì „í™” â†’ ì ‘ìˆ˜ì·¨ì†Œ"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ í•‘í¬ìƒ‰ [ë°˜ë‚©] í‘œì‹œë˜ì–´ì•¼ ì´ë¦„ ëº„ ìˆ˜ ìˆìŒ!"},
      {cat:"í‡´ì›ì•½",txt:"ì •ê·œ(10:30~17:30): ì‘ê¸‰ì•½êµ­ ë³´í˜¸ì ì§ì ‘ ìˆ˜ë ¹ ì•ˆë‚´"},
      {cat:"í‡´ì›ì•½",txt:"ë¹„ì •ê·œ: ê¸°ì†¡ê´€ or ì•½êµ­ì „í™” í›„ ë³´ì¡°ì› SMS"},
    ]
  },
  "ì ‘ìˆ˜ì·¨ì†Œ": {
    keywords: /ì ‘ìˆ˜.*ì·¨ì†Œ|ì·¨ì†Œ.*ì ‘ìˆ˜|ë¹„ë“±ë¡/i,
    icon: "âŒ",
    items: [
      {cat:"ì ˆì°¨",txt:"'ì‘ê¸‰í™˜ìë¹„ë“±ë¡ëŒ€ì¥'ì— í™˜ìì´ë¦„ ì˜¬ë¼ì™”ëŠ”ì§€ í™•ì¸"},
      {cat:"ì ˆì°¨",txt:"ì˜¤ë” D/C, ì•½Â·ì²˜ì¹˜ ë‹¤ ë°˜ë‚© ë° ì·¨ì†Œ í™•ì¸"},
      {cat:"ì ˆì°¨",txt:"ìˆ˜ë‚© call: ì ‘ìˆ˜ ì·¨ì†Œí•´ì£¼ì„¸ìš”"},
    ]
  },
  "ì´ì†¡": {
    keywords: /ì´ì†¡|í™˜ì.*ì´ì†¡|ì´ì†¡ë“±ë¡/i,
    icon: "ğŸš¶",
    items: [
      {cat:"ì •ê·œ",txt:"í™˜ìì´ì†¡ ì‹œìŠ¤í…œ ì´ìš©"},
      {cat:"ë¹„ì •ê·œ",txt:"í™˜ìì´ì†¡í‘œ íŒŒì¼ì— ì˜¬ë ¤ë†“ê¸°"},
      {cat:"ë¹„ì •ê·œ",txt:"#109 ì‚ë¡: 0-0 ___ê°€ì‹¤ ë¶„ ê³„ì‹­ë‹ˆë‹¤"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ í‡´ì‹¤ ì „ ì´ì†¡ë“±ë¡ ë¯¸ë¦¬! (ì´ë¦„ ë¹ ì§€ë©´ ì´ì†¡ ëª»í•¨)"},
    ]
  },
  "chest tube": {
    keywords: /chest.*tube|í‰ê´€ì‚½ê´€|í‰ê´€/i,
    icon: "ğŸ«",
    items: [
      {cat:"ì¤€ë¹„",txt:"Chest tube set"},
      {cat:"ì¤€ë¹„",txt:"ë©¸ê· ìƒë¦¬ì‹ì—¼ìˆ˜ ì±„ì›Œë„£ê¸° + ë©¸ê· ì¥ê°‘"},
      {cat:"ì¤€ë¹„",txt:"Suction í•  ê²½ìš°: suction line + ê±°ì¦ˆ"},
    ]
  },
  "post seizure": {
    keywords: /seizure|ë°œì‘|ê²½ë ¨|í¬ìŠ¤íŠ¸.*ì‹œì ¸/i,
    icon: "âš¡",
    items: [
      {cat:"ì¤€ë¹„",txt:"Wall O2 + Face mask (reservoir+)"},
      {cat:"ì¤€ë¹„",txt:"IV line í™•ë³´"},
      {cat:"ì¤€ë¹„",txt:"Suction tip + Saline"},
      {cat:"ì¤€ë¹„",txt:"ì¥ê°‘ + í—¬ë©§"},
      {cat:"íˆ¬ì•½",txt:"Keppra 2000mg loading: NS 150ml btlì— mix"},
    ]
  },
  "íŒŒìƒí’": {
    keywords: /íŒŒìƒí’|hyper-tet|boostrix|tetanus/i,
    icon: "ğŸ’‰",
    items: [
      {cat:"í™•ì¸",txt:"5ë…„ ì´ë‚´ ì ‘ì¢… ì´ë ¥ ìˆìœ¼ë©´ ì•ˆ ë§ì•„ë„ ë¨ â†’ ì¤„ ë•Œ ë¬¼ì–´ë³´ê¸°"},
      {cat:"íˆ¬ì•½",txt:"Hyper-tet: ëƒ‰ì¥ê³  ë¹„í’ˆ"},
      {cat:"íˆ¬ì•½",txt:"Boostrix: ì•½êµ­ call í•„ìš” â†’ ê°™ì´ ìš”ì²­"},
      {cat:"ì£¼ì˜",txt:"ì–‘ìª½ íŒ”ì— ë”°ë¡œ ì£¼ê¸°"},
    ]
  },
  "heparin": {
    keywords: /\bheparin\b|í—¤íŒŒë¦°|heparinization/i,
    icon: "ğŸ’‰",
    items: [
      {cat:"íˆ¬ì•½",txt:"IVS max 4000 unit"},
      {cat:"íˆ¬ì•½",txt:"Heparinization ì‹œ ë°˜ë“œì‹œ ëª¸ë¬´ê²Œ ì¸¡ì •"},
      {cat:"ì°¸ê³ ",txt:"Heparin 1:100 í¬ì„ â€” íœ´ì˜¨ìŠ¤ heparin 1000unit/10cc (ì˜´ë‹ˆì…€ ì ‘ìˆ˜)"},
    ]
  },
  "dalteparin": {
    keywords: /dalteparin|ë‹¬í…ŒíŒŒë¦°|\bLMWH\b|ì €ë¶„ìí—¤íŒŒë¦°/i,
    icon: "ğŸ’‰",
    items: [
      {cat:"ì ì‘ì¦",txt:"PTE í™˜ì"},
      {cat:"ìš©ëŸ‰",txt:">200 unit/kg/day [SC]"},
      {cat:"í™•ì¸",txt:"DPP ì´‰ì§€í•´ë³´ê¸°"},
    ]
  },
  "terlipressin": {
    keywords: /terlipressin|í„°ë¦¬í”„ë ˆì‹ /i,
    icon: "ğŸ’‰",
    items: [
      {cat:"ìœ„ì¹˜",txt:"ëƒ‰ì¥ê³ ì— ìˆìŒ"},
      {cat:"íˆ¬ì•½",txt:"ë³´í†µ 2mg loading â†’ 1mg qid, ë³´í†µ 3ì¼ê¹Œì§€"},
      {cat:"ì£¼ì˜",txt:"ì´í›„ ì‚¬ìš©ì€ ì£¼ì¹˜ì˜ í™•ì¸ í•„ìš”"},
    ]
  },
  "statin": {
    keywords: /statin|lipitor|ìŠ¤íƒ€í‹´|ë¦¬í”¼í† /i,
    icon: "ğŸ’Š",
    items: [
      {cat:"ì ì‘ì¦",txt:"NSTEMI í™˜ì â†’ Lipitor(statin) + water P.O"},
    ]
  },
  "steroid": {
    keywords: /dexamethasone|ë±ì‚¬|ìŠ¤í…Œë¡œì´ë“œ.*ë¡œë”©|steroid.*loading/i,
    icon: "ğŸ’Š",
    items: [
      {cat:"íˆ¬ì•½",txt:"Dexamethasone 10mg loading + 4mg/ml ìœ ì§€"},
      {cat:"ì°¸ê³ ",txt:"PPI ë³‘ìš© ê°€ëŠ¥"},
    ]
  },
  "lasix": {
    keywords: /lasix|ë¼ì‹ìŠ¤|furosemide|í‘¸ë¡œì„¸ë§ˆì´ë“œ/i,
    icon: "ğŸ’Š",
    items: [
      {cat:"íˆ¬ì•½",txt:"íˆ¬ì•½ í›„ 1hr effect ê¸°ë¡"},
    ]
  },
  "Grasin": {
    keywords: /grasin|ê·¸ë¼ì‹ |\bG-CSF\b|\bANC\b.*ë‚®/i,
    icon: "ğŸ’Š",
    items: [
      {cat:"íˆ¬ì•½",txt:"Grasin 300mcg(ë¹„í’ˆ) + D5W or NS 50ml ë˜ëŠ” SC"},
      {cat:"íˆ¬ì•½",txt:"ANC ë‚®ì€ ì‚¬ëŒ ë³´í†µ qd"},
      {cat:"ì£¼ì˜",txt:"âš ï¸ 150mcgë‘ í˜¼ë™ì£¼ì˜!!"},
    ]
  },
  "chemoport": {
    keywords: /chemoport.*culture|ì¼€ëª¨í¬íŠ¸.*ë°°ì–‘|í¬íŠ¸.*culture/i,
    icon: "ğŸ§«",
    items: [
      {cat:"ì¤€ë¹„",txt:"Chemoport needle: 3êµ¬ì—­ ëª¨ë‹ˆí„°ë§ ë„£ëŠ” ê³³ì— ìˆìŒ"},
      {cat:"ì£¼ì˜",txt:"ì£¼ì„ìŒ¤í•œí…Œ ì“´ë‹¤ê³  ë§í•˜ê¸° (ì£¼ì„ìŒ¤ì´ ì¹´ìš´íŠ¸)"},
      {cat:"ì˜¤ë”",txt:"Blood culture [central catheter, í˜ˆì•¡] â€” chemoport"},
      {cat:"ì˜¤ë”",txt:"Heparin 1:100 í¬ì„ ì˜¤ë” ë°›ì•„ì„œ ë“œë¦¬ê¸°"},
    ]
  },
  "callì—…ë¬´": {
    keywords: /call.*ì—…ë¬´|ì½œì—…ë¬´|êµ¬ì¡°ì‚¬.*ì—…ë¬´|ì „ë¬¸ê°„í˜¸ì‚¬.*ì—…ë¬´|\bCPN\b.*ì—…ë¬´/i,
    icon: "ğŸ“",
    items: [
      {cat:"êµ¬ì¡°ì‚¬",txt:"â‘  initial lab, ECG, urine, B/Cx â‘¡ 6A lab â‘¢ ABO sample â‘£ ì¶”ê°€ lab ë° IV í™•ë³´"},
      {cat:"ì „ë¬¸ê°„í˜¸ì‚¬",txt:"ì¤‘í™˜ì ê²€ì‚¬ë™ë°˜ / ë™ì˜ì„œ(ë§ˆì·¨,ìˆ˜ìˆ  ì œì™¸) / L-tubeÂ·foley insertion / tapping needle ì œê±° / simple splint / ì‚¬ë§í™˜ì ì¹´í…Œí„°ì œê±°Â·suture / ì‹¬ì „ë„ / ECMO priming"},
      {cat:"CPN",txt:"ê°ë‹´, ëŒ€ë³€, tapping, ì¶”ê°€ urine ê²€ì²´"},
      {cat:"CPN",txt:"í‰í†µê³„ initial EKG + 2hr F/U EKG / L-tubeÂ·foley insertion/irrigation"},
    ]
  },
  "Nightì—…ë¬´": {
    keywords: /night.*job|ë‚˜ì´íŠ¸.*ì—…ë¬´|ì•¼ê°„.*ì—…ë¬´|ë‹¹ì¼.*ìŠ¤ì¼€ì¤„ë§/i,
    icon: "ğŸŒ™",
    items: [
      {cat:"ìŠ¤ì¼€ì¤„ë§",txt:"ë‹¹ì¼ ìŠ¤ì¼€ì¤„ë§: ì „ë‚ ê³¼ ë¹„êµí•˜ì—¬ M/F, anti ë“± ì•½ í™•ì¸"},
      {cat:"I/O",txt:"00:00 ê¸°ì¤€ I/O ë‹¤ì‹œ ì‹œì‘ â€” ì„ìƒê´€ì°°ê¸°ë¡ì— 23:59 & 00:00 ê¸°ë¡, ì¸í“¨ì „íŒí”„ ì œë¡œì‰"},
      {cat:"ê¸°ë¡",txt:"ì„ìƒê´€ì°°ê¸°ë¡: ì¹¨ìƒë³´ì¡°ë‚œê°„, ì·¨ì¹¨ ì „ ë°°ë‡¨ í™•ì¸"},
      {cat:"ê²€ì‚¬",txt:"BST ê¸°ê¸° QC"},
      {cat:"ê²€ì‚¬",txt:"2~3Aê²½ ì •ê·œ [P]X-ray ì½œ(0050)"},
      {cat:"ê²€ì‚¬",txt:"ì •ê·œ lab: 6A"},
    ]
  },
  "Dayì—…ë¬´": {
    keywords: /day.*job|ë°ì´.*ì—…ë¬´|ì£¼ê°„.*ì—…ë¬´|eve.*job|ì´ë¸Œ.*ì—…ë¬´/i,
    icon: "â˜€ï¸",
    items: [
      {cat:"ì—…ë¬´",txt:"ìŠ¤ì¼€ì¤„ë§ ëœ ë¼ë²¨ í™•ì¸, ë¼ìš´ë”© í›„ ì •ê·œ ì°¨íŒ…"},
      {cat:"ì—…ë¬´",txt:"ì •ê·œì‹œê°„ì— ì…ì›ëŒ€ê¸° í™˜ì ìë¦¬ í™•ì¸"},
      {cat:"ì—…ë¬´",txt:"ì‹œìˆ  cst í™•ì¸ í›„ ìˆ ê¸°ë°©ì—ì„œ ë™ì˜ì„œ ë°›ê¸°"},
      {cat:"ì£¼ì˜",txt:"ë‚˜ì´íŠ¸ ë•ŒëŠ” ì£¼ì¹˜ì˜ ì½”ì‚¬ì¸ ë¬¸ì œë¡œ ë¯¸ë¦¬ ë°›ì§€ ì•Šê¸°ë¡œ í•¨"},
    ]
  },
  "NAì—…ë¬´": {
    keywords: /\bNA\b.*ì—…ë¬´|ë³´ì¡°ì›|ë¹„í’ˆ|ê¸°ì†¡ê´€/i,
    icon: "ğŸ§‘â€âš•ï¸",
    items: [
      {cat:"ë¹„í’ˆ",txt:"ë¹„í’ˆ ì—†ëŠ” ì•½: ê¸°ì†¡ê´€ or 82)2592,2977 ì•½êµ­ ì „í™” â†’ SMSë¡œ ìˆ˜ë ¹ ìš”ì²­"},
      {cat:"Set",txt:"C-line, foley(bag ì¢…ë¥˜), tapping set â†’ ìë¦¬ì— ì¤€ë¹„ ìš”ì²­ â†’ íŒŒì¼ì— ë¼ë²¨ ë¶™ì´ê¸°"},
      {cat:"ì •ë¦¬",txt:"#59 ì‚ë¡: 0-0 ìë¦¬ ì •ë¦¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤"},
    ]
  },
  "Antiíˆ¬ì•½": {
    keywords: /\banti\b.*íˆ¬ì•½|í•­ìƒì œ.*íˆ¬ì•½|antibiotics|anti.*culture/i,
    icon: "ğŸ’Š",
    items: [
      {cat:"í™•ì¸",txt:"Anti íˆ¬ì•½ ì „ culture ë‚˜ê°ˆì§€ confirm (blood Cx ì˜¤ë” ì—†ìœ¼ë©´ ë°›ê¸°)"},
      {cat:"í™•ì¸",txt:"ë‚˜ì´íŠ¸ ê·¼ë¬´ ì‹œ ì „ë‚ ì´ë‘ order ë‹¤ë¥´ë©´ confirm"},
      {cat:"OP",txt:"Oncall OP anti: ACTëŠ” ERì—ì„œ, antiëŠ” mix clamping ë˜ëŠ” ì¶œë°œ ì‹œ start"},
    ]
  },
};

// ==========================================
// [DOMAIN: LOGIC] íŒŒì‹± ë° ë¶„ì„ ì—”ì§„
// - smartParse(): í…ìŠ¤íŠ¸ ë¶„ì„ â†’ disposition/ê³¼/ì‹œìˆ /ì§€ì‹œ ì¶”ì¶œ
// - buildChecklist(): íŒŒì‹± ê²°ê³¼ â†’ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°°ì—´ ë³€í™˜
// ==========================================

function smartParse(text){
const t=text;
const r={disposition:null,departments:[],unit:null,procedures:[],opdItems:[],educationItems:[],npo:false,op:false,conditionalTasks:[],instructions:[],hasTransfusion:false};

// --- Disposition ---
const rsm=t.match(/ì…ì›ê²°ê³¼[^\n]*\n([^\n]*)/);
if(rsm){const rl=rsm[1];if(/ì „ì›|transfer/.test(rl))r.disposition="transfer";else if(/í‡´ì›|D\/C|d\/c|discharge|ê·€ê°€/.test(rl))r.disposition="discharge";else if(/ì…ì›|adm/i.test(rl))r.disposition="admission";}
if(!r.disposition){if(["ì „ì›","transfer","ì´ì†¡"].some(k=>t.includes(k)))r.disposition="transfer";else if(/í‡´ì›|D\/C|d\/c|discharge|ê·€ê°€/.test(t))r.disposition="discharge";else if(/\badm\b/i.test(t))r.disposition="admission";}

// --- ì§„ë£Œê³¼ ---
const dm={"IMR":["IMR","RESP","PULM","í˜¸í¡ê¸°","í˜¸í¡ê¸°ë‚´ê³¼","í„ëª¨","í’€ëª¨"],"IMJ":["IMJ","RHEU","RH","ë¥˜ë§ˆ","ë¥˜ë§ˆí‹°ìŠ¤","ë¥˜ë§ˆí‹°ìŠ¤ë‚´ê³¼","ì¡°ì¸íŠ¸"],"IMN":["IMN","NEPH","ì‹ ì¥","ì‹ ì¥ë‚´ê³¼","ë„¤í”„ë¡œ","RENAL"],"IMHO":["IMHO","HEM","ONCO","HO","í˜ˆì¢…","í˜ˆì•¡ì¢…ì–‘","í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼","í—´","ì˜¹ì½”"],"IMI":["IMI","INFEC","IF","ê°ë‚´","ê°ì—¼","ê°ì—¼ë‚´ê³¼","ì¸í™"],"IMG":["IMG","GI","GASTRO","ì†Œí™”ê¸°","ì†Œí™”ê¸°ë‚´ê³¼","ìœ„ì¥ê´€"],"IMC":["IMC","CV","CARD","CIRC","ìˆœí™˜ê¸°","ì‹¬ì¥","ì‹¬ì¥ë‚´ê³¼","ì¹´ë””ì˜¤"],"IME":["IME","ENDO","META","ë‚´ë¶„ë¹„","ë‚´ë¶„ë¹„ë‚´ê³¼","ë‚´ë¶„ë¹„ëŒ€ì‚¬","ì—”ë„"],"IMA":["IMA","ALLERGY","ALL","ì•Œë ˆë¥´ê¸°","ì•ŒëŸ¬ì§€"],"IMHM":["IMHM","ì…ì „","ì…ì „ì˜","ì…ì›ì „ë‹´","ì…ì›ì „ë‹´ì „ë¬¸ì˜"],"NP":["NP","PSY","ì •ì‹ ","ì •ì‹ ê³¼","ì •ì‹ ê±´ê°•ì˜í•™ê³¼","ì—”í”¼"],"NR":["NR","NU","NEURO","ì‹ ê²½ê³¼","ë‰´ë¡œ","ì—”ì•Œ"],"NS":["NS","N/S","NEUROSURG","ì‹ ê²½ì™¸ê³¼","ì—”ì—ìŠ¤","SPINE","BRAIN"],"GS":["GS","SURG","ì™¸ê³¼","ì¼ë°˜ì™¸ê³¼","ì¥ì—ìŠ¤","HBP","UGI","LGI"],"CS":["CS","TS","THORACIC","í‰ë¶€","í‰ë¶€ì™¸ê³¼","í‰ì™¸"],"OS":["OS","ORTHO","ì •í˜•","ì •í˜•ì™¸ê³¼","ì˜¤ì—ìŠ¤","BONE"],"EM":["EM","ER","ì‘ê¸‰","ì‘ê¸‰ì˜í•™ê³¼"],"PED":["PED","ì†Œì•„","ì†Œì²­ê³¼","í˜ë“œ"],"OBGY":["OBGY","ì‚°ë¶€ì¸ê³¼","ì‚°ê³¼","ë¶€ì¸ê³¼"],"URO":["URO","ë¹„ë‡¨","ë¹„ë‡¨ì˜í•™ê³¼","ìœ ë¡œ"],"ENT":["ENT","OTO","ì´ë¹„ì¸í›„ê³¼","ì´ì—”í‹°"],"RM":["RM","REHAB","ì¬í™œ","ì¬í™œì˜í•™ê³¼","ì•Œì— "]};
const shortDepts=new Set(["NR","NS","GS","CS","OS","NP","EM","RM","IF","GI","CV","HO","NU","RH"]);
for(const[d,ks]of Object.entries(dm))for(const k of ks){
  if(k.length<=2 || shortDepts.has(k)){
    const re=new RegExp("\\b"+k+"\\b","i");
    if(re.test(t)&&!r.departments.includes(d))r.departments.push(d);
  } else {
    if(t.includes(k)&&!r.departments.includes(d))r.departments.push(d);
  }
}

// --- íŠ¹ìˆ˜ ìœ ë‹› (SU, Stroke Unit, LICU, CCU, ICU ëŒ€ì‘) ---
if (/Stroke|ë‡Œì¡¸ì¤‘|\bSU\b/i.test(t)) {
    r.unit = "Stroke";
} 
else if (/LICU|ê°„ì§‘ì¤‘/i.test(t)) {
    r.unit = "LICU";
}
else if (/CCU/i.test(t)) {
    r.unit = "CCU";
} 
else if (/ICU|ì¤‘í™˜ìì‹¤/i.test(t)) {
    r.unit = "ICU";
}

// --- ì»¨ì„¤íŠ¸ í¬ë§· íŒë³„ (ì‹œìˆ  ë§¤ì¹­ ìŠ¤í‚µìš©) ---
const isConsultFormat = /íšŒì‹ |ìƒì„¸ë‚´ìš©|ì…ì›ì¹˜ë£Œ.*í•„ìš”|ì¢…í•©.*ì†Œê²¬|Recommendation|ê³„íš\s*ë°\s*ê¶Œê³ |íƒ€ê³¼íšŒì‹ |êµ¬ë¶„:\s*íƒ€ê³¼|íšŒì‹ \s*ê°œìš”|í‰ê°€\s*\(A\)|ê³„íš\s*\(P\)|ê¶Œê³ ì‚¬í•­|íšŒì‹ ì|ì§„ë£Œê³¼:\s*(ìˆœí™˜ê¸°|ì‹ ê²½|í˜¸í¡ê¸°|ì†Œí™”ê¸°|ê°ì—¼|ì‹ ì¥|í˜ˆì•¡|ì •í˜•|í‰ë¶€|ì‹ ê²½ì™¸)/i.test(t);

// --- ê²€ì‚¬/ì‹œìˆ : PROCEDURE_DB í‚¤ì›Œë“œ ë§¤ì¹­ (ì»¨ì„¤íŠ¸ íšŒì‹ ì—ì„œëŠ” ìŠ¤í‚µ) ---
if(!isConsultFormat){
const actionKw=/ì‹œí–‰\s*ì˜ˆì •|ì‹œí–‰\s*í•¨|ì‹œí–‰\s*í•˜|ì˜ˆì •|ì¤€ë¹„\s*í•´|ì½œ\s*í•´|call\s*í•´|ë‚´ì¼|ëª¨ë ˆ|1st|2nd|go\s*ì˜ˆì •|schedule/i;
const imagingActionKw=/ì‹œí–‰|ì˜ˆì •|ì°|ë³´ë‚´|ì´¬ì˜|ì˜ˆì•½|ì½œ|call|ì¤€ë¹„|go|schedule/i;
const imagingExclude=/ê²°ê³¼|ì†Œê²¬|ìƒ|íŒë…|reading|ë³´ë©´|ì—ì„œ|finding|review/i;
for(const[name,proc]of Object.entries(PROCEDURE_DB)){
  const m=t.match(proc.keywords);
  if(m){
    const idx=t.indexOf(m[0]);
    const nearby=t.substring(Math.max(0,idx-30),Math.min(t.length,idx+m[0].length+30));
    if(name==="CT"||name==="MRI"){
      if(imagingActionKw.test(nearby)&&!imagingExclude.test(nearby))r.procedures.push(name);
    } else {
      if(actionKw.test(nearby))r.procedures.push(name);
    }
  }
}
}

// --- OPD ---
const opdSet=new Set();
const opdKw=/ì™¸ë˜|OPD|opd|f\/u|F\/U|follow[- ]?up/i;
const opdSkipKw=/ìƒì„¸ë‚´ìš©|íšŒì‹ ë‚´ìš©|ì˜ë¢°ì˜|ë°°ìƒ|ì„ ìƒë‹˜|ì…ì›ì¹˜ë£Œ|ì¹˜ë£Œê³„íš.*ìƒì˜|ê³¼ê±°ë ¥|ê²½ê³¼.*ê´€ì°°|ì„ì¢…ì‹¤|ê°€ëŠ¥í•˜ë„ë¡|íšŒì‹ |ì†Œê²¬|Opinion|íƒ€ì›|íƒ€ë³‘ì›|ê³ ì‹ |í˜‘ì§„|ê³„íš.*ë°.*ê¶Œê³ |ê¶Œê³ ì‚¬í•­|ìƒì˜\s*ìš”ë§|ì˜ë¢°í•¨|ì˜ë¢°í•˜|ë³´ë‚´ë“œ|ì™¸ë˜.*ìƒì˜|OPD.*ìƒì˜|ì¶”ì ê´€ì°°|ê°ê´€ì |í‰ê°€\s*\(|ê³„íš\s*\(/i;
if(!isConsultFormat){
t.split(/\n/).forEach(line=>{
  const l=line.trim();
  if(!opdKw.test(l))return;
  if(opdSkipKw.test(l))return;
  let extracted=l.replace(/^[\*\-\d\.\)\s]+/,'').trim();
  if(extracted.length>60){
    const match=extracted.match(/.{0,25}(ì™¸ë˜|OPD|f\/u|F\/U|follow[- ]?up).{0,25}/i);
    if(match)extracted=match[0].trim();
  }
  const snuhOPD=/SNUH|ì„œìš¸ëŒ€|ë³¸ì›|ë‹¹ì›|(\b(IMR|IMJ|IMN|IMHO|IMI|IMG|IMC|IME|IMA|IMHM|NP|NR|NS|GS|CS|OS|EM|PED|OBGY|URO|ENT|RM)\b.*(?:ì™¸ë˜|OPD|f\/u))|(?:ì™¸ë˜|OPD|f\/u).*\b(IMR|IMJ|IMN|IMHO|IMI|IMG|IMC|IME|IMA|IMHM|NP|NR|NS|GS|CS|OS|EM|PED|OBGY|URO|ENT|RM)\b|ENDO\s*OPD|GI\s*OPD|CARD\s*OPD|as\s*scheduled/i;
  if(extracted.length>3 && (snuhOPD.test(extracted) || snuhOPD.test(l)))opdSet.add(extracted);
});
}
const opdArr=[...opdSet];
const opdFiltered=[];
for(let i=0;i<opdArr.length;i++){
  let skip=false;
  for(let j=0;j<opdArr.length;j++){
    if(i===j)continue;
    const wi=opdArr[i].split(/\s+/),wj=opdArr[j].split(/\s+/);
    const common=wi.filter(w=>w.length>1&&wj.includes(w));
    if(common.length>=2&&opdArr[i].length>opdArr[j].length){skip=true;break;}
  }
  if(!skip)opdFiltered.push(opdArr[i]);
}
r.opdItems=opdFiltered;

// --- êµìœ¡ ---
if(!isConsultFormat){
const es=new Set();
t.split(/[.\n]/).filter(l=>/êµìœ¡í•¨|êµìœ¡í•˜ì˜€|ì„¤ëª…í•¨|í•˜ì‹œë„ë¡|ì¬ë‚´ì›|ì¬ë°©ë¬¸/.test(l)).forEach(l=>{const c=l.trim();if(c.length>3)es.add(c);});
r.educationItems=[...es];
}

// --- NPO ---
if(!isConsultFormat && /NPO|npo|ê¸ˆì‹/.test(t))r.npo=true;

// --- OP ---
if(!isConsultFormat){
const om=t.match(/(\bOP\b|ìˆ˜ìˆ )/gi);
if(om)for(const m of om){const i=t.indexOf(m),nb=t.substring(Math.max(0,i-30),Math.min(t.length,i+m.length+30));if(/ì˜ˆì •|ë‚´ì¼|ëª¨ë ˆ|1st|2nd|ì‹œí–‰|ì§„í–‰|ì˜¬ë¼ê°€/i.test(nb)&&!/ì•„ë‹˜|ì—†|ì•ˆ |ë¶ˆí•„ìš”|ë¶ˆê°€|ì•ˆí•¨|ì·¨ì†Œ|ë³´ë¥˜/i.test(nb)){r.op=true;break;}}
}

// --- ì§„ë‹¨ì„œ ---
if(!isConsultFormat && /ì§„ë‹¨ì„œ|ì†Œê²¬ì„œ/.test(t))r.conditionalTasks.push({id:"c_doc",task:"ì§„ë‹¨ì„œ/ì„œë¥˜ë°œê¸‰",detail:"ì£¼ì¹˜ì˜ìš”ì²­(2ë§Œì›,ë¶€ë³¸1ì²œì›)",icon:"ğŸ“‘"});

// --- ìˆ˜í˜ˆ ---
r.hasTransfusion=(/ìˆ˜í˜ˆ|transfusion|RBC|FFP|pheresis|PLT Tf|plt tf/i.test(t));

// --- ì»¨ì„¤íŠ¸ íšŒì‹  íŒŒì‹± (ê³¼ë³„ í•µì‹¬ ìš”ì•½) ---

if(isConsultFormat){
  // ê³¼ë³„ íšŒì‹  ë¸”ë¡ ë¶„ë¦¬ â€” ë‹¤ì–‘í•œ í—¤ë” íŒ¨í„´
  const blocks = t.split(/(?=\d+\.\s*.+?(?:íšŒì‹ |ì„¼í„°|Recommendation)\s*[\(\[])/).filter(b=>b.trim());
  // ë¶„ë¦¬ ì•ˆ ë˜ë©´ ì „ì²´ë¥¼ 1ë¸”ë¡ìœ¼ë¡œ
  const finalBlocks = blocks.length > 0 ? blocks : [t];
  
  for(let bi=0; bi<finalBlocks.length; bi++){
    const block = finalBlocks[bi];
    if(!block.trim() || block.trim().length < 20) continue;
    
    // íšŒì‹ ê³¼ ì‹ë³„ â€” 1) ì²« ì¤„ì—ì„œ ê³¼ëª…, 2) ë³¸ë¬¸ì—ì„œ "IMR F." ê°™ì€ ì„œëª…, 3) ì•½ì–´
    let dept = "";
  const firstLine = block.split(/\n/)[0];
  const deptLineMatch = block.match(/ì§„ë£Œê³¼\s*:\s*([^\n\r]+)/);
  const searchLine = deptLineMatch ? deptLineMatch[1] : firstLine;
  const deptMatch = searchLine.match(/(ì™„í™”ì˜ë£Œ|ì„ìƒìœ¤ë¦¬|í˜¸ìŠ¤í”¼ìŠ¤|ë¹„ë‡¨ì˜í•™ê³¼|ë¹„ë‡¨ê¸°ê³¼|ì¢…ì–‘ë‚´ê³¼|í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼|í˜ˆì•¡ì¢…ì–‘|ì‹ ê²½ê³¼|ì‹ ê²½ì™¸ê³¼|í˜¸í¡ê¸°ë‚´ê³¼|ì†Œí™”ê¸°ë‚´ê³¼|ìˆœí™˜ê¸°ë‚´ê³¼|ì‹¬ì¥ë‚´ê³¼|ì •í˜•ì™¸ê³¼|í‰ë¶€ì™¸ê³¼|ì¬í™œì˜í•™ê³¼|ì •ì‹ ê±´ê°•|ê°ì—¼ë‚´ê³¼|ì‹ ì¥ë‚´ê³¼|ë‚´ë¶„ë¹„ë‚´ê³¼|ë‚´ë¶„ë¹„|ë¥˜ë§ˆí‹°ìŠ¤|ì•Œë ˆë¥´ê¸°|ì¼ë°˜ì™¸ê³¼|ì™¸ê³¼|ì‘ê¸‰ì˜í•™ê³¼|í”¼ë¶€ê³¼|ì•ˆê³¼|ì´ë¹„ì¸í›„ê³¼|ì‚°ë¶€ì¸ê³¼)/);
    if(deptMatch) dept = deptMatch[1];
    // ì•½ì–´ â€” ì²« ì¤„ì—ì„œ
    if(!dept){
      const abbr = firstLine.match(/\b(URO|GS|NS|NR|CS|OS|IMG|IMC|IMR|IMI|IMN|IME|IMJ|IMA|IMHO|NP|RM|PED|OBGY|ENT|EM)\b/i);
      if(abbr) dept = abbr[1].toUpperCase();
    }
    // ë³¸ë¬¸ ì„œëª…ì—ì„œ ê³¼ ì‹ë³„: "IMR F.", "ë‚´ê³¼ 2ë…„ì°¨", "GS R2" ë“±
    if(!dept){
      const sigMatch = block.match(/\b(URO|GS|NS|NR|CS|OS|IMG|IMC|IMR|IMI|IMN|IME|IMJ|IMA|IMHO|NP|RM|PED|OBGY|ENT|EM)\s*(?:F\.|R\d|êµìˆ˜|ì˜¬ë¦¼|ë°°ìƒ)/i);
      if(sigMatch) dept = sigMatch[1].toUpperCase();
    }
    // í•œê¸€ ê³¼ëª…ì—ì„œ ì„œëª… ì¶”ì¶œ: "ë‚´ê³¼ 2ë…„ì°¨", "í˜¸í¡ê¸°ë‚´ê³¼ F."
    if(!dept){
      const korSig = block.match(/(í˜¸í¡ê¸°ë‚´ê³¼|ì†Œí™”ê¸°ë‚´ê³¼|ìˆœí™˜ê¸°ë‚´ê³¼|ê°ì—¼ë‚´ê³¼|ì‹ ì¥ë‚´ê³¼|í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼|ì¢…ì–‘ë‚´ê³¼|ì‹ ê²½ê³¼|ì‹ ê²½ì™¸ê³¼|ì •í˜•ì™¸ê³¼|í‰ë¶€ì™¸ê³¼|ì™¸ê³¼|ë¹„ë‡¨ì˜í•™ê³¼)\s*(?:F\.|R\d|êµìˆ˜|ì˜¬ë¦¼|ì „ì„ì˜|ì „ê³µì˜)/i);
      if(korSig) dept = korSig[1];
    }
    // ê³¼ ì´ë¦„ì—ì„œ ì•½ì–´ë¡œ
    const deptAbbrMap = {"ë¹„ë‡¨ì˜í•™ê³¼":"URO","ë¹„ë‡¨ê¸°ê³¼":"URO","ì¢…ì–‘ë‚´ê³¼":"IMHO","í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼":"IMHO","í˜ˆì•¡ì¢…ì–‘":"IMHO","ì‹ ê²½ê³¼":"NR","ì‹ ê²½ì™¸ê³¼":"NS","í˜¸í¡ê¸°ë‚´ê³¼":"IMR","ì†Œí™”ê¸°ë‚´ê³¼":"IMG","ìˆœí™˜ê¸°ë‚´ê³¼":"IMC","ì‹¬ì¥ë‚´ê³¼":"IMC","ì •í˜•ì™¸ê³¼":"OS","í‰ë¶€ì™¸ê³¼":"CS","ì¬í™œì˜í•™ê³¼":"RM","ì •ì‹ ê±´ê°•":"NP","ê°ì—¼ë‚´ê³¼":"IMI","ì‹ ì¥ë‚´ê³¼":"IMN","ë‚´ë¶„ë¹„ë‚´ê³¼":"IME","ë‚´ë¶„ë¹„":"IME","ë¥˜ë§ˆí‹°ìŠ¤":"IMJ","ì•Œë ˆë¥´ê¸°":"IMA","ì¼ë°˜ì™¸ê³¼":"GS","ì™¸ê³¼":"GS","ì™„í™”ì˜ë£Œ":"ì™„í™”ì˜ë£Œ","ì„ìƒìœ¤ë¦¬":"ì™„í™”ì˜ë£Œ","í˜¸ìŠ¤í”¼ìŠ¤":"ì™„í™”ì˜ë£Œ","í”¼ë¶€ê³¼":"DERM","ì•ˆê³¼":"EYE","ì´ë¹„ì¸í›„ê³¼":"ENT","ì‚°ë¶€ì¸ê³¼":"OBGY"};
    const deptCode = deptAbbrMap[dept] || dept;
    if(!deptCode) continue;
    
    // ìƒì„¸ë‚´ìš© ì¶”ì¶œ â€” ë‹¤ì–‘í•œ í—¤ë” íŒ¨í„´ ì§€ì›
    let detailText = "";
    // 1ìˆœìœ„: "ê³„íš ë° ê¶Œê³ " ì„¹ì…˜
    const planMatch = block.match(/ê³„íš\s*ë°\s*ê¶Œê³ \s*(?:\(P\))?\s*\n([\s\S]*?)(?=í–‰ì •\s*ì‚¬í•­|íšŒì‹ ì\s*:|$)/i);
    if(planMatch) {
      detailText = planMatch[1];
    } else {
      // 2ìˆœìœ„: ê¸°ì¡´ í—¤ë” íŒ¨í„´
      const detailMatch = block.match(/(?:ìƒì„¸ë‚´ìš©|íšŒì‹ ë‚´ìš©\s*ìš”ì•½|ì¢…í•©\s*ì†Œê²¬|Opinion|Recommendation\s*>?)\s*[:\s]*([\s\S]*?)(?=ì…ì›ì¹˜ë£Œ|í–‰ì •\s*ì‚¬í•­|íšŒì‹ ì|$)/i);
      if(detailMatch){
        detailText = detailMatch[0];
      } else {
        const hwMatch = block.match(/íšŒì‹ ë‚´ìš©[\s\S]*?(?=ì…ì›ì¹˜ë£Œ|$)/i);
        if(hwMatch) detailText = hwMatch[0];
        else detailText = block.split(/\n/).slice(1).join('\n');
      }
    }
    if(detailText.length < 10) continue;
    
    // ë…¸ì´ì¦ˆ ì œê±° íŒ¨í„´
    const noiseKw = /ì„ ìƒë‹˜|ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ|ë°°ìƒ$|ê°ì‚¬í•©ë‹ˆë‹¤|íšŒì‹ ë‚´ìš©|ìƒì„¸ë‚´ìš©|í™˜ìì§„ë£Œì‹œê°|ì˜ë¢°ì˜|ì‘ì„±ì‹œê°„|ìµœì¢…ì‘ì„±ì|ì¢…í•©\s*ì†Œê²¬|Opinion|^\s*[\*\-]\s*$|ì´ˆìŒíŒŒ\s*ì†Œê²¬\s*ë¹„êµ|í˜¸í¡ë¶€ì „\s*ì›ì¸|ìœ„í—˜ì„±:|ê¶Œê³ ì‚¬í•­:|ê°ê´€ì \s*ì†Œê²¬|í‰ê°€\s*\(A\)|V\/S:|Lab:|ABGA:|Bedside/;
    const dateOnly = /^\s*\d{4}-\d{2}-\d{2}/;
    const bgInfo = /í™•ì¸ë˜ì—ˆë˜ í™˜ì|í™˜ìì…ë‹ˆë‹¤$|í™˜ìë¶„ì…ë‹ˆë‹¤|ë‚´ì›í•˜ì‹ |ì§„ë£Œì˜ë¢°|ì§„ë‹¨ëª…|Diagnosis|ê³¼ê±°ë ¥:|ì´ˆê¸° ì§„ë‹¨ ì‹œì—ë„|ì˜ë¢° ì‚¬ìœ :|ê¸°ì €ì§ˆí™˜/;
    const diagLine = /^\d+\.\s*[A-Z].*(?:stage|s\/p|Fx|HTN|cancer|DLBL|effusion|impairment)/i;
    
    // í•µì‹¬ ë¬¸ì¥ ì¶”ì¶œ â€” ì˜í•™ ì•½ì–´(G.C, s/p, r/o, Lt., Rt., op., Pf.)ì˜ ë§ˆì¹¨í‘œëŠ” ë³´ì¡´
    const safeDetail = detailText.replace(/\b([A-Za-z])\.([A-Za-z])/g, '$1\u00B7$2').replace(/\b(s\/p|r\/o|op|Lt|Rt|Pf|Dr)\./gi, '$1\u00B7');
    // ë¬¸ì¥ ë¶„ë¦¬: ë§ˆì¹¨í‘œ, ì¤„ë°”ê¿ˆ, ë˜ëŠ” "~ë¶„ìœ¼ë¡œ," "~ì—†ì–´" ê°™ì€ ì ‘ì† íŒ¨í„´
    const sentences = safeDetail.split(/\.\s|\n|(?<=.{30}),\s*(?=í˜„ì¬|í•´ë‹¹|ì…ì›|ê°€ëŠ¥|í˜¸ìŠ¤í”¼ìŠ¤|ë‹¤ë§Œ|ì¶”ê°€)/).map(s=>s.replace(/\u00B7/g,'.').replace(/^\s*[\*\-\d\.\)]\s*/,'').trim()).filter(s=>{
      if(s.length < 8) return false;
      if(noiseKw.test(s)) return false;
      if(dateOnly.test(s) && s.length < 15) return false;
      if(/^\s*(?:ìƒì„¸ë‚´ìš©|íšŒì‹ ë‚´ìš©|ì¢…í•©\s*ì†Œê²¬)\s*:?\s*$/i.test(s)) return false;
      if(bgInfo.test(s)) return false;
      if(diagLine.test(s)) return false;
      return true;
    });
    
    // í•µì‹¬ í‚¤ì›Œë“œ ê¸°ë°˜ ìš”ì•½ (í–‰ë™ ê°€ëŠ¥í•œ ê²ƒ ìš°ì„ )
    const highPriority = [];
    const actionSentences = [];
    const infoSentences = [];
    
    sentences.forEach(s => {
      // ìµœìš°ì„ : í˜¸ìŠ¤í”¼ìŠ¤/ì „ì›/ì—°ëª…/ì„œë¥˜ ê´€ë ¨
      if(/í˜¸ìŠ¤í”¼ìŠ¤|hospice|ì „ì›|ì—°ëª….*ë¶ˆì›|ì„œë¥˜.*ì‘ì„±|ìƒë‹´.*ì™„ë£Œ|POLST|polst|DNR|dnr|ì‚¬ì „ì—°ëª…/i.test(s)){
        highPriority.push(s);
      }
      else if(/ì…ì›|í‡´ì›|ì¹˜ë£Œ.*ê³„íš|chemotherapy|í•­ì•”.*ì¶”ì²œ|í•­ì•”.*ë¶ˆê°€|ìˆ˜ìˆ |ì‹œí–‰|íˆ¬ì•½|ì¤‘ë‹¨|ìœ ì§€|ì˜ë¢°|ë¶€íƒ|ì¶”ì²œ|ê¶Œê³ |í•„ìš”|ì™¸ë˜|f\/u|FU|follow|ìƒì˜|ê³ ë ¤|ì–´ë ¤ìš´|ì–´ë ¤ì›€|ë¶ˆê°€|ê°€ëŠ¥|ì™„í™”|ì—°ëª…|ê¶Œí•˜ì§€|ê¶Œìœ í•˜ì§€|stent|weaning|ë³‘ìƒ|ì „í™˜|ê¸°ëŒ€ìˆ˜ëª…|ìƒë‹´|ìš”ë§|echocardiography|echo|ì‹œí–‰\s*ìš”ë§|í™•ì¸\s*ìš”ë§|ì˜ë¢°\s*ìš”ë§/i.test(s)){
        actionSentences.push(s);
      } else if(/í™•ì¸|ìƒíƒœ|ì†Œê²¬|ê²°ê³¼|ì‚¬ìœ |ì›ì¸|ì¬ë°œ|ì•…í™”/i.test(s)){
        infoSentences.push(s);
      }
    });
    
    // ìµœëŒ€ 3ê°œ: ìµœìš°ì„  â†’ í–‰ë™ â†’ ì •ë³´ ìˆœì„œ
    const picked = [];
    highPriority.forEach(s => { if(picked.length < 3) picked.push(s); });
    actionSentences.forEach(s => { if(picked.length < 3) picked.push(s); });
    if(picked.length === 0) infoSentences.forEach(s => { if(picked.length < 1) picked.push(s); });
    
    // ì…ì› í•„ìš” ì—¬ë¶€
    const admNeeded = /ì…ì›ì¹˜ë£Œ.*í•„ìš”.*ì—¬ë¶€[\s\S]{0,30}ì˜ˆ/i.test(block);
    const transferRec = /íƒ€ë³‘ì›.*ì „ì›/i.test(block);
    
    // disposition ë³´ì¡° íŒë‹¨
    if(transferRec && !r.disposition) r.disposition = "transfer";
    if(admNeeded && !r.disposition) r.disposition = "admission";

    // ì…ì›/ì „ì› ì •ë³´ë¥¼ suffixë¡œ ë³‘í•©
    let suffix = "";
    if(admNeeded && transferRec) suffix = " â†’ íƒ€ë³‘ì› ì „ì› ì¶”ì²œ";
    else if(admNeeded) suffix = " â†’ ì…ì›ì¹˜ë£Œ í•„ìš”";
    else if(transferRec) suffix = " â†’ íƒ€ë³‘ì› ì „ì› ì¶”ì²œ";
    
    // ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜
    picked.forEach((s, idx) => {
      let cat = "ê²€ì‚¬";
      let icon = "ğŸ”¬";
      if(/ì „ì›|ì…ì›|í‡´ì›|discharge|ë³‘ìƒ|ì „ê³¼|ì „ë™/i.test(s)){ cat="ë°°ì¹˜"; icon="ğŸ¥"; }
      else if(/í˜¸ìŠ¤í”¼ìŠ¤|hospice|ì™„í™”|ì—°ëª…|ê¶Œí•˜ì§€|ê¶Œìœ í•˜ì§€|ì„ì¢…/i.test(s)){ cat="ì™„í™”ì˜ë£Œ"; icon="ğŸ•Šï¸"; }
      else if(/ìˆ˜ìˆ .*ì–´ë ¤|ìˆ˜ìˆ ì  ì¹˜ë£Œ.*ì–´ë ¤|ë¶ˆê°€/i.test(s)){ cat="ì†Œê²¬"; icon="ğŸ”ª"; }
      else if(/ìˆ˜ìˆ |op |ì‹œìˆ |stent|insertion|ì¡°ì¹˜/i.test(s)){ cat="ìˆ˜ìˆ /ì‹œìˆ "; icon="ğŸ”ª"; }
      else if(/chemo|í•­ì•”/i.test(s)){ cat="í•­ì•”"; icon="ğŸ’Š"; }
      else if(/íˆ¬ì•½|ì•½ë¬¼|ìœ ì§€|ì¤‘ë‹¨|ì²˜ë°©|supplement|infusion|íˆ¬ì—¬|ì ìš©|CRRT/i.test(s)){ cat="íˆ¬ì•½"; icon="ğŸ’Š"; }
      else if(/ì˜ë¢°|í˜‘ì§„|consult|ë¶€íƒ|ì˜ê²¬.*í™•ì¸|ì¬í˜‘ì§„|ìƒì˜/i.test(s)){ cat="í˜‘ì§„"; icon="ğŸ¥"; }
      else if(/ì™¸ë˜|OPD|f\/u|follow/i.test(s)){ cat="ì™¸ë˜"; icon="ğŸ“…"; }
      else if(/support|care|nutritional|ì˜ì–‘/i.test(s)){ cat="ê°„í˜¸"; icon="ğŸ’‰"; }
      else if(/ê¸°ëŒ€ìˆ˜ëª…|ì˜ˆí›„|ì˜ˆìƒ/i.test(s)){ cat="ì˜ˆí›„"; icon="â³"; }
      else if(/ìƒë‹´|ì„œë¥˜|ê°€ì¡±/i.test(s)){ cat="ìƒë‹´"; icon="ğŸ‘¥"; }
      else { cat="ì†Œê²¬"; icon="ğŸ”¬"; }
      
      // ë§ˆì§€ë§‰ í•­ëª©ì—ë§Œ suffix ë¶™ì´ê¸°
      let detail = s;
      if(idx === picked.length - 1 && suffix) detail += suffix;
      if(detail.length > 100) detail = detail.substring(0, 97) + "...";
      
      r.instructions.push({
        id: "cst_"+bi+"_"+idx,
        task: deptCode,
        detail: detail,
        icon: icon,
        category: cat,
        blockIdx: bi
      });
    });
  }
} else {
  // --- ê¸°ì¡´ ì»¨ì„¤íŠ¸ ì§€ì‹œì‚¬í•­ ì¶”ì¶œ (ë¹„íšŒì‹  í¬ë§·) ---
  const lines=t.split(/\n/);
  const instrKw=/ìœ ì§€|ì¶”ì²œ|ê¶Œê³ |ì‹œí–‰|ì¤‘ë‹¨|ë³€ê²½|ê°ëŸ‰|ì¦ëŸ‰|ì¶”ê°€|ì œê±°|ì‹œì‘|ì§€ì†|íˆ¬ì•½|íˆ¬ì—¬|ì²˜ë°©|í˜‘ì§„|consult|ì˜ë¢°|í•´ì£¼|ë°”ëë‹ˆë‹¤|ë¶€íƒ|ë“œë¦½ë‹ˆë‹¤|í•˜ì‹­ì‹œì˜¤|ê³ ë ¤/i;
  const skipKw=/^ì…ì›ê²½ê³¼|^ì…ì›ê²°ê³¼|^í–¥í›„ê³„íš|^í‡´ì›ì¥ì†Œ|^ì§„ë£Œê¸°ë¡|^\s*$|adm|ì…ì›/i;
    
  for(let i=0;i<lines.length;i++){
    const line=lines[i].trim();
    if(!line||skipKw.test(line)||line.length<5)continue;
    const isNumbered=/^\d+[\.\)]\s*/.test(line)||/^[\*\-]\s+/.test(line);
    if(isNumbered||instrKw.test(line)){
      const cleaned=line.replace(/^\d+[\.\)]\s*/,'').replace(/^[\*\-]\s+/,'').trim();
      if(cleaned.length>5){
        let cat="ì§€ì‹œ";
        if(/ìœ ì§€|ì§€ì†|íˆ¬ì•½|íˆ¬ì—¬|ì²˜ë°©|ì‹œì‘|ì¦ëŸ‰/i.test(cleaned))cat="íˆ¬ì•½";
        if(/ì¤‘ë‹¨|ê°ëŸ‰|ì œê±°|ì—†ì„|ë¶ˆí•„ìš”|ì´ìœ ëŠ” ì—†/i.test(cleaned))cat="íˆ¬ì•½ë³€ê²½";
        if(/í˜‘ì§„|consult|ì˜ë¢°/i.test(cleaned))cat="í˜‘ì§„";
        if(/ì™¸ë˜|OPD|opd|f\/u|FU|follow/i.test(cleaned))cat="ì™¸ë˜";
        if(/ê²€ì‚¬|ì´¬ì˜|imaging|MRI|CT|X-ray|lab|ì‹œí–‰/i.test(cleaned))cat="ê²€ì‚¬";
        if(cat==="ì™¸ë˜"||cat==="êµìœ¡")continue;
        const icons={"íˆ¬ì•½":"ğŸ’Š","íˆ¬ì•½ë³€ê²½":"âš ï¸","í˜‘ì§„":"ğŸ¥","ê²€ì‚¬":"ğŸ”¬","ì§€ì‹œ":"ğŸ“‹"};
        r.instructions.push({id:"instr_"+i,task:cat,detail:cleaned,icon:icons[cat]||"ğŸ“‹",category:cat});
      }
    }
  }
}
r.isConsult = isConsultFormat;
return r;
}

function buildChecklist(p){
  const items=[];
  // ì…ì› ì‹œ ê³¼ë³„/ìœ ë‹›ë³„ ì°¸ê³ 
  if(p.disposition==="admission"){
    for(const d of p.departments)if(DEPT_NOTES[d])items.push({id:"dept_"+d,task:d+" ì…ì›ì°¸ê³ ",detail:DEPT_NOTES[d],icon:"ğŸ“Œ",type:"context",highlight:false});
    if(p.unit&&UNIT_CONSENTS[p.unit])items.push({id:"unit_"+p.unit,task:p.unit+" ë™ì˜ì„œ",detail:UNIT_CONSENTS[p.unit],icon:"ğŸ“",type:"conditional",highlight:true});
    if(p.npo)items.push({id:"c_npo",task:"NPOìœ ì§€í™•ì¸",detail:"ê¸ˆì‹ìƒíƒœìœ ì§€",icon:"ğŸš«",type:"conditional"});
    if(p.op){
      const opProc=PROCEDURE_DB["OP"];
      if(opProc){
        opProc.prep.forEach((txt,i)=>items.push({id:"op_prep_"+i,task:txt,detail:"[OP ì¤€ë¹„]",icon:"ğŸ“‹",type:"conditional",highlight:false}));
        opProc.med.forEach((txt,i)=>items.push({id:"op_med_"+i,task:txt,detail:"[OP íˆ¬ì•½]",icon:"ğŸ’Š",type:"conditional"}));
        opProc.warning.forEach((txt,i)=>items.push({id:"op_warn_"+i,task:txt,detail:"[OP ì£¼ì˜]",icon:"âš ï¸",type:"conditional",highlight:false}));
      }
    }
  }
  // ì»¨ì„¤íŠ¸ ì§€ì‹œì‚¬í•­ (ë¸”ë¡ë³„ â†’ ê³¼ë³„ íƒœê·¸)
  for(const instr of p.instructions){
    items.push({
      id: instr.id,
      task: "["+instr.task+"] " + instr.detail,
      detail: instr.category,
      icon: instr.icon,
      type:"conditional",
      highlight: /ë°°ì¹˜|íˆ¬ì•½ë³€ê²½|í˜‘ì§„|ì™„í™”ì˜ë£Œ/.test(instr.category)
    });
  }
  // ê²€ì‚¬/ì‹œìˆ 
  for(const procName of (p.isConsult ? [] : p.procedures)){
    const proc=PROCEDURE_DB[procName];
    if(!proc)continue;
    const pid="proc_"+procName;
    proc.prep.forEach((txt,i)=>items.push({id:pid+"_prep_"+i,task:txt,detail:"["+procName+" ì¤€ë¹„]",icon:"ğŸ“‹",type:"conditional"}));
    if(proc.med)proc.med.forEach((txt,i)=>items.push({id:pid+"_med_"+i,task:txt,detail:"["+procName+" íˆ¬ì•½]",icon:"ğŸ’Š",type:"conditional"}));
    proc.post.forEach((txt,i)=>items.push({id:pid+"_post_"+i,task:txt,detail:"["+procName+" ì‚¬í›„]",icon:"ğŸ”",type:"conditional"}));
    proc.warning.forEach((txt,i)=>items.push({id:pid+"_warn_"+i,task:txt,detail:"["+procName+" ì£¼ì˜]",icon:"âš ï¸",type:"conditional",highlight:proc.important||false}));
    if(proc.transfer)proc.transfer.filter(x=>x).forEach((txt,i)=>items.push({id:pid+"_trans_"+i,task:txt,detail:"["+procName+" ì´ì†¡]",icon:"ğŸš‘",type:"conditional"}));
  }
  // OPD
  for(const o of p.opdItems)items.push({id:"opd_"+o,task:"ì™¸ë˜ì˜ˆì•½í™•ì¸",detail:o,icon:"ğŸ“…",type:"conditional",highlight:true});
  // êµìœ¡
  for(let i=0;i<p.educationItems.length;i++)items.push({id:"edu_"+i,task:"í‡´ì›êµìœ¡",detail:p.educationItems[i],icon:"ğŸ“š",type:"conditional"});
  // ê¸°íƒ€ ì¡°ê±´ë¶€
  for(const c of p.conditionalTasks)items.push({...c,type:"conditional"});
  // ìˆ˜í˜ˆ - dispositionë³„
  if(p.hasTransfusion){
    if(p.disposition==="admission")items.push({id:"c_bf",task:"ìˆ˜í˜ˆ ë³‘ë™ì¸ê³„",detail:"ë‚¨ì€í˜ˆì•¡ ë³‘ë™ì¸ê³„. MF hold ì£¼ì¹˜ì˜í™•ì¸",icon:"ğŸ©¸",type:"conditional"});
    else items.push({id:"c_bf",task:"ìˆ˜í˜ˆ ì™„ë£Œí™•ì¸",detail:"ìˆ˜í˜ˆì™„ë£Œ ì—¬ë¶€ í™•ì¸",icon:"ğŸ©¸",type:"conditional"});
  }
  // í•„ìˆ˜
  (MANDATORY[p.disposition]||[]).forEach(m=>items.push({...m,type:"mandatory"}));
  return items;
}

// ==========================================
// [DOMAIN: UI & EVENT] í™”ë©´ ë Œë”ë§ ë° ì‚¬ìš©ì ì´ë²¤íŠ¸
// - generate(): ë©”ì¸ ì‹¤í–‰ (ê²€ìƒ‰/ë¶„ì„ ëª¨ë“œ ë¶„ê¸°)
// - showProtocol(): ì‹œìˆ  ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
// - showGuide(): ê°€ì´ë“œ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
// - render(): í™”ë©´ ë Œë”ë§ (ì²´í¬ë¦¬ìŠ¤íŠ¸ í‘œì‹œ)
// - rItem(): ê°œë³„ í–‰ ë Œë”ë§
// - tog(), esc(), closeReminder(), resetAll(), toggleTheme(), regen()
// - updateBtn(): ì‹¤í–‰ë²„íŠ¼ ìƒíƒœ ê´€ë¦¬
// - window.onload: ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë°”ì¸ë”©
// ==========================================

function updateBtn(){
  const btn = document.getElementById("btnGen");
  if(btn) btn.classList.add("active");
}

function generate(text) {
  try {
    const t = (text || document.getElementById("inputText").value).trim();
    if (!t) {
      alert("âš ï¸ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ì˜ˆì‹œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!");
      return;
    }
    
    // ëª¨ë“œ ì´ˆê¸°í™”
    activeTitle = null;

    // 1ë‹¨ê³„: ê²€ìƒ‰ ëª¨ë“œ (í‚¤ì›Œë“œ ì…ë ¥ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜)
   if (t.length < 20) {
      if (/^\s*PCD\s*$/i.test(t)) {
        showProtocol(["abdPCD","chestPCD"]);
        return;
      }
      // PROCEDURE_DB ê²€ìƒ‰
      const matched = [];
      for (const [name, proc] of Object.entries(PROCEDURE_DB)) {
        if (proc.keywords.test(t)) matched.push(name);
      }
      if (matched.length > 0) {
        showProtocol(matched.length === 1 ? matched[0] : matched);
        return;
      }
      // GUIDE_DB ê²€ìƒ‰
      const gMatched = [];
      for (const [name, guide] of Object.entries(GUIDE_DB)) {
        if (guide.keywords.test(t)) gMatched.push(name);
      }
      if (gMatched.length > 0) {
        showGuide(gMatched);
        return;
      }
    }
    // 2ë‹¨ê³„: ë¶„ì„ ëª¨ë“œ
    ci = t;
    cp = smartParse(t);
    cl = buildChecklist(cp);
    cs = {};
    document.getElementById("inputScreen").classList.add("hidden");
    document.getElementById("resultScreen").classList.add("hidden");
    document.getElementById("btnReset").style.display = "block";
    if (cp.disposition === "discharge" || cp.disposition === "transfer") {
      document.getElementById("reminderPopup").classList.remove("hidden");
    }
    render();
  } catch (err) {
    alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
  }
}

// ê°€ì´ë“œ í‘œì‹œ í•¨ìˆ˜
function showGuide(guideNames) {
  if (typeof guideNames === 'string') guideNames = [guideNames];
  cl = [];
  
  activeTitle = { name: guideNames.join(' / '), icon: "ğŸ“–" };

  guideNames.forEach(gName => {
    const guide = GUIDE_DB[gName];
    if (!guide) return;
    if (guideNames.length > 1) {
      cl.push({ id: gName+"_hdr", task: "â”â” " + gName + " â”â”", detail: "", icon: guide.icon||"ğŸ“–", type: "manual", highlight: false });
    }
    let prevCat = "";
    guide.items.forEach((item, idx) => {
      const catChanged = item.cat !== prevCat;
      prevCat = item.cat;
      const isWarn = /ì£¼ì˜|ê¸ˆê¸°/.test(item.cat) || item.txt.startsWith("âš ï¸");
      const icon = isWarn ? "âš ï¸" : (guide.icon||"ğŸ“–");
      cl.push({
        id: `g_${gName}_${idx}`,
        task: item.txt,
        detail: catChanged ? "["+item.cat+"]" : "",
        icon: icon,
        type: "manual",
        highlight: isWarn
      });
    });
  });

  cs = {};
  document.getElementById("inputScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  document.getElementById("btnReset").style.display = "block";
  render();
}

// íƒ€ì´í‹€ì„ ë¦¬ìŠ¤íŠ¸ì—ì„œ ë¹¼ê³  ë³„ë„ ë³€ìˆ˜(activeTitle)ë¡œ ê´€ë¦¬
function showProtocol(procNames) {
  if (typeof procNames === 'string') procNames = [procNames];
  cl = [];
  
  activeTitle = { name: procNames.join(' / '), icon: "ğŸ“˜" };

  const addItems = (list, procName, prefix, tag, icon, isWarn) => {
    list.forEach((txt, idx) => {
      cl.push({
        id: `${procName}_${prefix}_${idx}`,
        task: txt,
        detail: tag,
        icon: icon,
        type: "manual",
        highlight: isWarn
      });
    });
  };

  procNames.forEach(procName => {
    const proc = PROCEDURE_DB[procName];
    if (!proc) return;
    if (procNames.length > 1) {
      cl.push({ id: procName+"_hdr", task: "â”â” " + procName + " â”â”", detail: "", icon: "ğŸ“˜", type: "manual", highlight: false });
    }
    if(proc.prep&&proc.prep.length) addItems(proc.prep, procName, "prep", "[ì¤€ë¹„]", "ğŸ“‹", false);
    if(proc.med&&proc.med.length) addItems(proc.med, procName, "med", "[íˆ¬ì•½]", "ğŸ’Š", false);
    if(proc.post&&proc.post.length) addItems(proc.post, procName, "post", "[ì‚¬í›„]", "ğŸ”", false);
    if(proc.warning&&proc.warning.length) addItems(proc.warning, procName, "warn", "[ì£¼ì˜]", "âš ï¸", true);
    if(proc.transfer) addItems(proc.transfer.filter(x=>x), procName, "transfer", "[ì´ì†¡]", "ğŸš‘", false);
  });

  cs = {};
  document.getElementById("inputScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  document.getElementById("btnReset").style.display = "block";
  render();
}
function render(){
  const c=document.getElementById("resultScreen");
  const done=Object.values(cs).filter(Boolean).length;
  const total=cl.length;
  const pct=total?Math.round(done/total*100):0;
  
  let h = "";
  
  // ê²€ìƒ‰ ëª¨ë“œì¼ ë•Œ íƒ€ì´í‹€ í—¤ë”
  if(activeTitle) {
      h += `<div class="complete-bar" style="background:var(--bg2); border:1px solid var(--blue); text-align:left; padding:12px; margin-bottom:10px; display:flex; align-items:center; gap:10px;">
        <span style="font-size:20px;">${activeTitle.icon}</span>
        <div>
            <div style="font-size:15px; font-weight:700; color:var(--blue);">${activeTitle.name} ${activeTitle.icon==="ğŸ“–"?"ì—…ë¬´ ê°€ì´ë“œ":"í‘œì¤€ ì§€ì¹¨"}</div>
            <div style="font-size:11px; color:var(--text2);">${activeTitle.icon==="ğŸ“–"?"ER ì—…ë¬´ ì°¸ê³ ì‚¬í•­":"ì‹œìˆ  ì „í›„ ê°„í˜¸ í™•ì¸"}</div>
        </div>
      </div>`;
  } else if (cp && cp.disposition) {
      // ë¶„ì„ ëª¨ë“œ: disposition bar + summary
      const di={admission:{l:"ì…ì›",c:"var(--blue)",bc:"var(--hdr-border)",e:"ğŸ¥"},discharge:{l:"í‡´ì›",c:"var(--green)",bc:"var(--section-mand-border)",e:"ğŸ "},transfer:{l:"ì „ì›",c:"var(--orange)",bc:"var(--warn-border)",e:"ğŸš‘"}};
      const d=di[cp.disposition];
      if(d){
         const tags=cp.departments.map(dp=>`<span class="dispo-tag" style="color:${d.c};border-color:${d.c}">${dp}</span>`).join(' ');
         const utag=cp.unit?`<span class="dispo-tag" style="color:var(--yellow);border-color:var(--yellow)">${cp.unit}</span>`:'';
         const sum=[cp.instructions.length>0&&"ì§€ì‹œ"+cp.instructions.length+"ê±´",cp.procedures.length>0&&"ì‹œìˆ "+cp.procedures.length+"ê±´",cp.opdItems.length>0&&"ì™¸ë˜"+cp.opdItems.length+"ê±´",cp.educationItems.length>0&&"êµìœ¡"+cp.educationItems.length+"ê±´",cp.npo&&"NPO",cp.op&&cp.disposition==="admission"&&"OPì˜ˆì •"].filter(Boolean).join(" Â· ")||"ì¶”ê°€í•­ëª©ì—†ìŒ";
         h+=`<div class="dispo-bar" style="border-color:${d.bc}"><span class="dispo-emoji">${d.e}</span><span class="dispo-type" style="color:${d.c}">${d.l}</span>${tags}${utag}<span class="dispo-info">${sum}</span></div>`;
      }
  } else if(cp && !cp.disposition) {
      h+='<div class="warn-bar">âš ï¸ Disposition íŒë³„ ë¶ˆê°€ â€” ì…ì›/í‡´ì›/ì „ì› í‚¤ì›Œë“œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</div>';
  }

  h += `<div class="progress-row"><span class="prog-label">ì§„í–‰</span><div class="prog-track"><div class="prog-fill" style="width:${pct}%;background:${pct===100?'var(--green)':'var(--red)'}"></div></div><span class="prog-text" style="color:${pct===100?'var(--green)':'var(--red)'};">${done}/${total}</span></div>`;
  
  // ê²€ìƒ‰ ëª¨ë“œ: ì„¹ì…˜ êµ¬ë¶„ ì—†ì´ ë°”ë¡œ í‘œì‹œ
  if(activeTitle){
    cl.forEach(i=>{h+=rItem(i);});
  } else {
    // ë¶„ì„ ëª¨ë“œ: ì§€ì‹œì—ì„œ ì¶”ì¶œ / í•„ìˆ˜ í•­ëª© êµ¬ë¶„
    const cond=cl.filter(x=>x.type==="conditional"||x.type==="context");
    const mand=cl.filter(x=>x.type==="mandatory");
    if(cond.length>0){
      h+=`<div class="section-hdr cond"><span class="section-dot" style="background:var(--red)"></span>ì§€ì‹œì—ì„œ ì¶”ì¶œ</div>`;
      cond.forEach(i=>{h+=rItem(i);});
    }
    if(mand.length>0){
      h+=`<div class="section-hdr mand" style="margin-top:6px"><span class="section-dot" style="background:var(--green)"></span>í•„ìˆ˜ í•­ëª©</div>`;
      mand.forEach(i=>{h+=rItem(i);});
    }
  }
  
  if(pct===100)h+=`<div class="complete-bar"><div style="font-size:24px;margin-bottom:4px">âœ…</div><div style="font-size:13px;font-weight:700;color:var(--green)">ì „ì²´ ì™„ë£Œ</div></div>`;
  
  // ë¶„ì„ ëª¨ë“œì¼ ë•Œë§Œ ì›ë¬¸ ë³´ê¸°
  if(!activeTitle && ci) {
      h+=`<details><summary>â–¶ ì›ë¬¸ë³´ê¸°/ìˆ˜ì •</summary><div class="edit-box"><textarea oninput="ci=this.value" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();regen();}" placeholder="Enter = ë‹¤ì‹œìƒì„± / Shift+Enter = ì¤„ë°”ê¿ˆ">${esc(ci)}</textarea><button class="btn-regen" onclick="regen()">â–¶ ë‹¤ì‹œìƒì„±</button></div></details>`;
  }
  
  c.innerHTML=h;
  c.classList.remove("hidden");
}

function rItem(item){
  const d=cs[item.id],hl=item.highlight&&!d;
  const rc=d?"row done-row":(hl?"row hl":"row");
  const ck=d?'<div class="cb checked"><svg width="10" height="10" viewBox="0 0 12 12" fill="none"><path d="M2.5 6L5 8.5L9.5 3.5" stroke="var(--svg-check)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>':'<div class="cb"></div>';
  const tc=d?"row-task done":"row-task";
  const dc=d?"row-detail done":"row-detail";
  return `<div class="${rc}" onclick="tog('${item.id}')"><div class="row-check">${ck}</div><div class="row-icon">${item.icon}</div><div class="row-content"><div class="${tc}">${esc(item.task)}</div>${item.detail?`<div class="${dc}">${esc(item.detail)}</div>`:''}</div></div>`;
}

function tog(id){cs[id]=!cs[id];render();}
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function closeReminder(){document.getElementById("reminderPopup").classList.add("hidden");}
function resetAll(){location.reload();}
function toggleTheme(){
   document.body.classList.toggle('light');
   localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');}
function regen(){ const ta=document.querySelector("#resultScreen textarea"); if(ta){ci=ta.value; generate(ci);} }

window.onload = function() {
    if(localStorage.getItem('theme')==='light') document.body.classList.add('light');
    updateBtn();

    // ë¶„ì„ ì‹¤í–‰ ë²„íŠ¼
    const btnGen = document.getElementById("btnGen");
    if(btnGen){
      btnGen.addEventListener('touchend', function(e){
        e.preventDefault();
        document.getElementById('inputText').blur();
        generate();
      });
      btnGen.addEventListener('click', function(e){
        generate();
      });
    }

    // ì˜ˆì‹œ ë²„íŠ¼
    const ec=document.getElementById("exCon");
    if(ec) {
        EXAMPLES.forEach(ex=>{
          const b=document.createElement("button");
          b.className="btn-ex";
          b.textContent=ex.label;
          b.addEventListener('touchend', function(e){ e.preventDefault(); document.getElementById("inputText").value=ex.text; generate(ex.text); });
          b.addEventListener('click', function(){ document.getElementById("inputText").value=ex.text; generate(ex.text); });
          ec.appendChild(b);
        });
    }
};
</script>
</body>
</html>
