<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ER Mate - ìŠ¤ë§ˆíŠ¸ ê°„í˜¸ ë„ìš°ë¯¸</title>
<style>
  :root {
    --bg: #0a0a0a; --bg2: #111; --bg3: #1a1a1a; --border: #2a2a2a; --border2: #1a1a1a;
    --text: #e0e0e0; --text2: #9a9a9a; --text3: #888; --text-dim: #666;
    --hdr-bg1: #1a2744; --hdr-bg2: #0f1a30; --hdr-border: #2a4a7a;
    --blue: #7eb8f7; --green: #6adb6a; --red: #ff6b6b; --yellow: #f0c040; --orange: #f0a040;
    --input-bg: #0a0a0a; --input-border: #333; --input-text: #e0e0e0;
    --row-hover: #1a1a2a; --row-hl: #1a1010;
    --cb-bg: #0a0a0a; --cb-border: #444; --cb-checked: #2a6a2a; --cb-checked-border: #4a8a4a;
    --section-cond-bg1: #2a1515; --section-cond-bg2: #1a0a0a; --section-cond-border: #4a2020;
    --section-mand-bg1: #152215; --section-mand-bg2: #0a150a; --section-mand-border: #2a3a2a;
    --panel-hdr-bg1: #1e3050; --panel-hdr-bg2: #152238; --panel-hdr-border: #2a4a6a;
    --modal-bg: #111; --modal-hdr-bg1: #3a3000; --modal-hdr-bg2: #2a2000; --modal-border: #4a3a00;
    --modal-text: #ddd;
    --complete-bg: #0a1a0a; --complete-border: #2a4a2a;
    --overlay-bg: rgba(0,0,0,0.8);
    --btn-ex-bg: #151515; --btn-ex-border: #2a2a2a; --btn-ex-text: #8aba8a;
    --tab-bg: #1a1a1a; --tab-border: #333;
    --task-text: #e8e8e8; --task-done: #555; --detail-done: #444;
    --logo-bg: #2a6abf;
    --dispo-bar-bg: #0f1a30;
    --warn-bg: #1a1500; --warn-border: #4a3a00;
    --prog-bg: #222;
    --svg-check: #fff;
  }
  body.light {
    --bg: #f4f5f7; --bg2: #fff; --bg3: #eef0f2; --border: #d0d4da; --border2: #e2e5ea;
    --text: #1a1a2e; --text2: #555; --text3: #777; --text-dim: #999;
    --hdr-bg1: #1e3a5f; --hdr-bg2: #15294a; --hdr-border: #2a5a9a;
    --blue: #2a6abf; --green: #1a8a1a; --red: #d04040; --yellow: #b08000; --orange: #c07020;
    --input-bg: #fff; --input-border: #c0c4ca; --input-text: #1a1a2e;
    --row-hover: #e8eaf0; --row-hl: #fef0f0;
    --cb-bg: #fff; --cb-border: #aaa; --cb-checked: #2a8a2a; --cb-checked-border: #1a6a1a;
    --section-cond-bg1: #fef0f0; --section-cond-bg2: #fff5f5; --section-cond-border: #e0a0a0;
    --section-mand-bg1: #f0faf0; --section-mand-bg2: #f5fff5; --section-mand-border: #a0c0a0;
    --panel-hdr-bg1: #1e3a5f; --panel-hdr-bg2: #15294a; --panel-hdr-border: #2a5a9a;
    --modal-bg: #fff; --modal-hdr-bg1: #fff3d0; --modal-hdr-bg2: #ffedaa; --modal-border: #d0a030;
    --modal-text: #333;
    --complete-bg: #f0faf0; --complete-border: #a0c0a0;
    --overlay-bg: rgba(0,0,0,0.4);
    --btn-ex-bg: #eef0f2; --btn-ex-border: #c0c4ca; --btn-ex-text: #2a7a2a;
    --tab-bg: #eef0f2; --tab-border: #c0c4ca;
    --task-text: #1a1a2e; --task-done: #aaa; --detail-done: #ccc;
    --logo-bg: #2a6abf;
    --dispo-bar-bg: #e8f0fa;
    --warn-bg: #fff8e0; --warn-border: #d0a030;
    --prog-bg: #d0d4da;
    --svg-check: #fff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { min-height: 100vh; background: var(--bg); font-family: 'Malgun Gothic', -apple-system, sans-serif; color: var(--text); font-size: 13px; transition: background .2s, color .2s; }
  header { background: linear-gradient(180deg, var(--hdr-bg1), var(--hdr-bg2)); border-bottom: 2px solid var(--hdr-border); padding: 6px 12px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
  .hdr-left { display: flex; align-items: center; gap: 8px; }
  .hdr-logo { background: var(--logo-bg); color: #fff; font-weight: 800; font-size: 11px; padding: 3px 6px; border-radius: 2px; }
  .hdr-title { color: #fff; font-weight: 700; font-size: 13px; }
  .hdr-sub { color: #8aa; font-size: 11px; margin-left: 6px; }
  .hdr-right { display: flex; align-items: center; gap: 6px; }
  .btn-new { background: var(--hdr-bg1); border: 1px solid var(--hdr-border); color: #fff; padding: 6px 14px; font-size: 12px; cursor: pointer; border-radius: 2px; display: none; touch-action: manipulation; }
  .btn-theme { background: none; border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 6px 10px; font-size: 14px; cursor: pointer; border-radius: 2px; line-height: 1; touch-action: manipulation; }
  .toolbar { background: var(--bg2); border-bottom: 1px solid var(--border); padding: 4px 12px; display: flex; gap: 2px; }
  .tab { padding: 4px 14px; font-size: 11px; background: var(--tab-bg); border: 1px solid var(--tab-border); border-bottom: none; color: var(--yellow); border-radius: 3px 3px 0 0; font-weight: 700; }
  main { max-width: 700px; margin: 0 auto; padding: 8px 10px 80px; }
  .input-panel { background: var(--bg2); border: 1px solid var(--border); border-radius: 2px; margin-bottom: 8px; }
  .input-header { background: linear-gradient(180deg, var(--panel-hdr-bg1), var(--panel-hdr-bg2)); padding: 5px 10px; font-size: 11px; font-weight: 700; color: #fff; border-bottom: 1px solid var(--panel-hdr-border); }
  .input-body { padding: 8px; }
  textarea { width: 100%; min-height: 120px; padding: 8px; background: var(--input-bg); border: 1px solid var(--input-border); color: var(--input-text); font-family: 'Malgun Gothic', monospace; font-size: 12px; resize: vertical; outline: none; line-height: 1.7; border-radius: 1px; }
  .btn-run { width: 100%; margin-top: 6px; padding: 14px 0; background: var(--blue); border: none; color: #fff; font-size: 14px; font-weight: 700; cursor: pointer; border-radius: 4px; }
  .examples { padding: 6px 0; display: flex; flex-wrap: wrap; gap: 4px; }
  .ex-label { font-size: 10px; color: var(--text3); margin-bottom: 4px; }
  .btn-ex { padding: 6px 12px; background: var(--btn-ex-bg); border: 1px solid var(--btn-ex-border); color: var(--btn-ex-text); font-size: 12px; cursor: pointer; border-radius: 2px; }
  .result { animation: fi 0.15s ease; }
  @keyframes fi { from{opacity:0} to{opacity:1} }
  .dispo-bar { background: var(--dispo-bar-bg); border: 1px solid var(--hdr-border); border-radius: 2px; padding: 8px 10px; margin-bottom: 6px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .dispo-emoji { font-size: 16px; }
  .dispo-type { font-size: 14px; font-weight: 800; }
  .dispo-tag { font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 2px; border: 1px solid; }
  .dispo-info { font-size: 11px; color: var(--text2); margin-left: auto; }
  .warn-bar { background: var(--warn-bg); border: 1px solid var(--warn-border); border-radius: 2px; padding: 6px 10px; margin-bottom: 6px; color: var(--yellow); font-size: 12px; }
  .progress-row { display: flex; align-items: center; gap: 8px; padding: 5px 10px; background: var(--bg2); border: 1px solid var(--border); border-radius: 2px; margin-bottom: 8px; }
  .prog-label { font-size: 10px; color: var(--text3); white-space: nowrap; }
  .prog-track { flex: 1; height: 4px; background: var(--prog-bg); border-radius: 1px; overflow: hidden; }
  .prog-fill { height: 100%; transition: width 0.3s; border-radius: 1px; }
  .prog-text { font-size: 11px; font-weight: 700; white-space: nowrap; }
  .section-hdr { border: 1px solid; border-radius: 2px; padding: 4px 10px; font-size: 11px; font-weight: 700; margin-bottom: 2px; display: flex; align-items: center; gap: 6px; }
  .section-hdr.cond { color: var(--red); border-color: var(--section-cond-border); background: linear-gradient(180deg, var(--section-cond-bg1), var(--section-cond-bg2)); }
  .section-hdr.mand { color: var(--green); border-color: var(--section-mand-border); background: linear-gradient(180deg, var(--section-mand-bg1), var(--section-mand-bg2)); }
  .section-dot { width: 6px; height: 6px; border-radius: 1px; display: inline-block; }
  .row { display: flex; align-items: flex-start; border-bottom: 1px solid var(--border2); cursor: pointer; transition: background 0.1s; }
  .row:hover { background: var(--row-hover); }
  .row.done-row { opacity: 0.3; }
  .row.hl { background: var(--row-hl); }
  .row-check { width: 32px; min-height: 34px; display: flex; align-items: center; justify-content: center; border-right: 1px solid var(--border2); flex-shrink: 0; }
  .cb { width: 14px; height: 14px; border: 1px solid var(--cb-border); background: var(--cb-bg); display: flex; align-items: center; justify-content: center; border-radius: 1px; }
  .cb.checked { background: var(--cb-checked); border-color: var(--cb-checked-border); }
  .cb svg { display: none; }
  .cb.checked svg { display: block; }
  .row-icon { width: 28px; min-height: 34px; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }
  .row-content { flex: 1; padding: 7px 10px; min-width: 0; }
  .row-task { font-size: 13px; font-weight: 600; color: var(--task-text); line-height: 1.4; }
  .row-task.done { color: var(--task-done); text-decoration: line-through; }
  .row-detail { font-size: 12px; color: var(--text2); margin-top: 3px; line-height: 1.5; }
  .row-detail.done { color: var(--detail-done); }
  .complete-bar { background: var(--complete-bg); border: 1px solid var(--complete-border); border-radius: 2px; padding: 14px; text-align: center; margin-top: 8px; }
  .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--overlay-bg); display: flex; align-items: center; justify-content: center; z-index: 999; padding: 16px; }
  .modal { background: var(--modal-bg); border: 2px solid var(--yellow); border-radius: 3px; max-width: 400px; width: 100%; box-shadow: 0 0 30px rgba(240,192,64,0.15); }
  .modal-hdr { background: linear-gradient(180deg, var(--modal-hdr-bg1), var(--modal-hdr-bg2)); padding: 8px 12px; font-size: 13px; font-weight: 700; color: var(--yellow); border-bottom: 1px solid var(--modal-border); text-align: center; }
  .modal-body { padding: 12px; }
  .modal-item { display: flex; gap: 8px; margin-bottom: 5px; font-size: 12px; color: var(--modal-text); line-height: 1.6; }
  .btn-modal-ok { width: 100%; margin-top: 10px; padding: 12px 0; background: linear-gradient(180deg, var(--modal-hdr-bg1), var(--modal-hdr-bg2)); border: 1px solid var(--modal-border); color: var(--yellow); font-size: 13px; font-weight: 700; cursor: pointer; border-radius: 2px; }
  details { margin-top: 10px; }
  summary { font-size: 11px; color: var(--text3); cursor: pointer; padding: 4px 0; border-bottom: 1px solid var(--border2); }
  .edit-box textarea { min-height: 80px; width: 100%; margin-top: 5px; }
  .btn-regen { width: 100%; margin-top: 4px; padding: 6px 0; background: var(--hdr-bg1); border: 1px solid var(--hdr-border); color: #fff; font-size: 11px; font-weight: 700; cursor: pointer; border-radius: 2px; }
  .hidden { display: none !important; }
</style>
</head>
<body>
<header>
  <div class="hdr-left">
    <span class="hdr-logo">EM</span>
    <span class="hdr-title">ER Mate</span>
    <span class="hdr-sub">v2.1.1 | 2026.02.21</span> 
  </div>
  <div class="hdr-right">
    <button class="btn-theme" id="btnTheme" onclick="toggleTheme()">â˜€ï¸</button>
    <button class="btn-new" id="btnReset" onclick="resetAll()">ìƒˆë¡œê³ ì¹¨</button>
  </div>
</header>

<div class="toolbar">
  <div class="tab">ì›Œí¬ìŠ¤í…Œì´ì…˜</div>
</div>

<main>
  <div id="inputScreen">
    <div class="input-panel">
      <div class="input-header">â–¶ ìŠ¤ë§ˆíŠ¸ ì˜¤ë” ë¶„ì„ / í”„ë¡œí† ì½œ ê²€ìƒ‰</div>
      <div class="input-body">
        <textarea id="inputText" placeholder="ì…ì›ê²½ê³¼ë¶€í„° í‡´ì›ì¥ì†Œê¹Œì§€ ë³µì‚¬í•´ ë„£ê±°ë‚˜, ì‹œìˆ ëª…(ERCP, CT ë“±)ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        <button class="btn-run" id="btnGen" onclick="generate()">âš¡ ER Mate ë¶„ì„ ì‹¤í–‰</button>
      </div>
    </div>
    <div class="ex-label">ë¹ ë¥¸ ì‹¤í–‰ (ì˜ˆì‹œ)</div>
    <div class="examples" id="exCon"></div>
  </div>

  <div id="resultScreen" class="hidden result"></div>

  <div id="reminderPopup" class="overlay hidden">
    <div class="modal">
      <div class="modal-hdr">âš¡ ë†“ì¹˜ê¸° ì‰¬ìš´ í‡´ì› ì˜¤ë” ì²´í¬!</div>
      <div class="modal-body">
        <div class="modal-item"><span>ğŸ“…</span><span>ì™¸ë˜ ì˜ˆì•½ í™•ì¸í•˜ì…¨ë‚˜ìš”? (ì§ì ‘ ì˜ˆì•½ or ì£¼ì¹˜ì˜ í™•ì¸)</span></div>
        <div class="modal-item"><span>ğŸ’Š</span><span>í‡´ì›ì•½ ì ‘ìˆ˜ í™•ì¸ & ë‚¨ì€ ì•½ ë°˜ë‚©</span></div>
        <div class="modal-item"><span>ğŸ§ </span><span>íŠ¹ìˆ˜ê²€ì‚¬(EEG, Holter) ì˜ˆì•½ í™•ì¸</span></div>
        <button class="btn-modal-ok" onclick="closeReminder()">ë„¤, í™•ì¸í–ˆìŠµë‹ˆë‹¤!</button>
      </div>
    </div>
  </div>
</main>

<script>
// DB ì •ì˜ë¶€ (ë‚´ìš© ìƒëµ - ê¸°ì¡´ DBì™€ ë™ì¼)
const MANDATORY={discharge:[{id:"m_d1",task:"í‡´ì›ì•½ í™•ì¸",detail:"ì •ê·œ:ì‘ê¸‰ì•½êµ­ ìˆ˜ë ¹ / ë¹„ì •ê·œ:ê¸°ì†¡ê´€",icon:"ğŸ’Š"},{id:"m_d2",task:"ë‚¨ì€ì•½ ë°˜ë‚©",detail:"ë°˜ë‚©ìš©ì§€+ì•½ â†’ ì†Œë…ë¬¼ì‹¤",icon:"â†©ï¸"},{id:"m_d3",task:"Line ì œê±°",detail:"IV line ë“± ì œê±°",icon:"ğŸ’‰"},{id:"m_d4",task:"ê¸°ë¡ì§€ ì „ë‹¬",detail:"ìˆ˜ë‚© ì „ë‹¬",icon:"ğŸ“„"},{id:"m_d5",task:"ì¹¨ìƒì •ë¦¬",detail:"#59ì‚ë¡",icon:"ğŸ§¹"}],admission:[{id:"m_a1",task:"ì…ì›ì§€ì‹œ í™•ì¸",detail:"ë‚´ê³¼â†’EMO / ì™¸ê³¼â†’ì§ì ‘ë°œí–‰",icon:"ğŸ“‹"},{id:"m_a2",task:"ë³‘ì‹¤ë°°ì •",detail:"ë³‘ë™ì „í™” ë° ì¸ê³„í™•ì¸",icon:"ğŸ›ï¸"},{id:"m_a3",task:"ì•½ ë°˜ë‚© í™•ì¸",detail:"ë‚¨ì€ì•½ ë°˜ë‚©ì²˜ë¦¬",icon:"â†©ï¸"},{id:"m_a4",task:"ì´ì†¡ë“±ë¡",detail:"í‡´ì‹¤ ì „ ë¯¸ë¦¬ë“±ë¡ í•„ìˆ˜!",icon:"ğŸš¶"},{id:"m_a5",task:"ì¹¨ìƒì •ë¦¬",detail:"#59ì‚ë¡",icon:"ğŸ§¹"}],transfer:[{id:"m_t1",task:"ì „ì›ë™ì˜ì„œ/ì†Œê²¬ì„œ",detail:"ì£¼ì¹˜ì˜ í™•ì¸",icon:"ğŸ“"},{id:"m_t2",task:"ì˜ë¬´ê¸°ë¡/CDë³µì‚¬",detail:"ì „ì›ì „ë‹´ê°„í˜¸ì‚¬",icon:"ğŸ’¿"},{id:"m_t3",task:"êµ¬ê¸‰ì°¨ì•ˆë‚´",detail:"ì‚¬ì„¤ê¸°ë³¸8ë§Œ/#0896",icon:"ğŸš‘"},{id:"m_t4",task:"ì¹¨ìƒì •ë¦¬",detail:"#59ì‚ë¡",icon:"ğŸ§¹"}]};
const PROCEDURE_DB = { "ERCP": { keywords: /ERCP/i, prep: ["NPO ìœ ì§€", "ë™ì˜ì„œ í™•ì¸"], med: ["í•­ìƒì œ í™•ì¸"], post: ["Amy/Lip í™•ì¸"], warning: ["Pancreatitis ì£¼ì˜"], transfer: ["ë‚´ì‹œê²½ì„¼í„°(2574)"] }, "CT": { keywords: /\bCT\b/i, prep: ["20G IV í™•ë³´", "ì¡°ì˜ì œ ì „ì²˜ì¹˜"], post: ["ì˜ìƒ í™•ì¸"], warning: ["TNI í™•ì¸"] } };
const GUIDE_DB = { "ìˆ˜í˜ˆ": { keywords: /ìˆ˜í˜ˆ|blood/i, icon: "ğŸ©¸", items: [{cat:"ì¤€ë¹„",txt:"ë™ì˜ì„œ í™•ì¸"},{cat:"ì¤€ë¹„",txt:"ABO sample ì±„í˜ˆ"}] } };
const EXAMPLES=[{label:"í‡´ì›ì˜ˆì‹œ",text:"ì…ì›ê²°ê³¼\ní‡´ì›\ní–¥í›„ê³„íš\nOPD f/u ì˜ˆì •\ní‡´ì›ì¥ì†Œ\nê·€ê°€"},{label:"#ì˜¤ë”ì˜ˆì‹œ",text:"# hydration\n# IMHO cst\n# CFTXN ìœ ì§€"}];

let cl=[],cs={},cp=null,ci="",activeTitle=null;

function smartParse(text){
  const t=text;
  const r={disposition:null,departments:[],unit:null,procedures:[],opdItems:[],educationItems:[],npo:false,op:false,conditionalTasks:[],instructions:[],hasTransfusion:false};

  // Disposition íŒë³„
  if(/ì „ì›|transfer/i.test(t)) r.disposition="transfer";
  else if(/í‡´ì›|D\/C|discharge/i.test(t)) r.disposition="discharge";
  else if(/ì…ì›|adm/i.test(t)) r.disposition="admission";

  // ì¼ë°˜ ê¸°ë¡ ì¶”ì¶œ ë¡œì§ (ìˆ˜ì •ëœ í•µì‹¬ ì„¹ì…˜)
  const lines = t.split(/\n/);
  const instrKw = /ìœ ì§€|ì¶”ì²œ|ê¶Œê³ |ì‹œí–‰|ì¤‘ë‹¨|ë³€ê²½|ê°ëŸ‰|ì¦ëŸ‰|ì¶”ê°€|ì œê±°|ì‹œì‘|ì§€ì†|íˆ¬ì•½|íˆ¬ì—¬|ì²˜ë°©|í˜‘ì§„|consult|cst|ì˜ë¢°|í•´ì£¼|ë°”ëë‹ˆë‹¤|ë¶€íƒ|ë“œë¦½ë‹ˆë‹¤|í•˜ì‹­ì‹œì˜¤|ê³ ë ¤|hydration|ìˆ˜ì•¡|f\/u|check|ê´€ì°°/i;
  const skipKw = /^ì…ì›ê²½ê³¼|^ì…ì›ê²°ê³¼|^í–¥í›„ê³„íš|^í‡´ì›ì¥ì†Œ|^ì§„ë£Œê¸°ë¡|^\s*$|^[=]+$/i;
      
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line || skipKw.test(line) || line.length < 2) continue; 
    
    const isNumbered = /^\d+[\.\)]\s*/.test(line) || /^[\*\-#]\s+/.test(line);
    const hasAction = instrKw.test(line);
    
    if (isNumbered || hasAction) {
      const cleaned = line.replace(/^\d+[\.\)]\s*/, '').replace(/^[\*\-#]\s+/, '').trim();
      if (cleaned.length >= 2) {
        let cat = "ì§€ì‹œ";
        if (/ìœ ì§€|ì§€ì†|íˆ¬ì•½|íˆ¬ì—¬|ì²˜ë°©|ì‹œì‘|ì¦ëŸ‰|hydration|ìˆ˜ì•¡/i.test(cleaned)) cat = "íˆ¬ì•½";
        else if (/ì¤‘ë‹¨|ê°ëŸ‰|ì œê±°|ì—†ì„|ë¶ˆí•„ìš”/i.test(cleaned)) cat = "íˆ¬ì•½ë³€ê²½";
        else if (/í˜‘ì§„|consult|cst|ì˜ë¢°/i.test(cleaned)) cat = "í˜‘ì§„";
        else if (/ì™¸ë˜|OPD|f\/u/i.test(cleaned)) cat = "ì™¸ë˜";
        if (cat === "ì™¸ë˜") continue; 

        const icons = { "íˆ¬ì•½": "ğŸ’Š", "íˆ¬ì•½ë³€ê²½": "âš ï¸", "í˜‘ì§„": "ğŸ¥", "ì§€ì‹œ": "ğŸ“‹" };
        r.instructions.push({ 
          id: "instr_" + i + "_" + Math.random().toString(36).substr(2, 5), 
          task: cat, 
          detail: cleaned, 
          icon: icons[cat] || "ğŸ“‹", 
          category: cat 
        });
      }
    }
  }
  return r;
}

function buildChecklist(p){
  const items=[];
  p.instructions.forEach(instr => items.push({id: instr.id, task: "["+instr.task+"] "+instr.detail, detail: instr.category, icon: instr.icon, type: "conditional"}));
  (MANDATORY[p.disposition]||[]).forEach(m=>items.push({...m,type:"mandatory"}));
  return items;
}

function generate(text) {
  try {
    const t = (text || document.getElementById("inputText").value).trim();
    if (!t) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    
    ci = t; activeTitle = null;
    cp = smartParse(t);
    cl = buildChecklist(cp);
    cs = {};

    document.getElementById("inputScreen").classList.add("hidden");
    document.getElementById("resultScreen").classList.remove("hidden");
    document.getElementById("btnReset").style.display = "block";
    render();
  } catch (err) { alert("ì˜¤ë¥˜: " + err.message); }
}

function render(){
  const c = document.getElementById("resultScreen");
  const done = Object.values(cs).filter(Boolean).length;
  const total = cl.length;
  const pct = total ? Math.round(done / total * 100) : 0;
  
  let h = `<div class="progress-row"><div class="prog-track"><div class="prog-fill" style="width:${pct}%;background:var(--green)"></div></div><span class="prog-text">${done}/${total}</span></div>`;
  
  const cond = cl.filter(x => x.type === "conditional");
  const mand = cl.filter(x => x.type === "mandatory");

  if(cond.length > 0){
    h += `<div class="section-hdr cond">ì§€ì‹œ ì¶”ì¶œ</div>`;
    cond.forEach(i => h += rItem(i));
  }
  if(mand.length > 0){
    h += `<div class="section-hdr mand">í•„ìˆ˜ í•­ëª©</div>`;
    mand.forEach(i => h += rItem(i));
  }
  c.innerHTML = h;
}

function rItem(item){
  const d=cs[item.id];
  const ck=d?'<div class="cb checked">V</div>':'<div class="cb"></div>';
  return `<div class="row ${d?'done-row':''}" onclick="tog('${item.id}')"><div class="row-check">${ck}</div><div class="row-icon">${item.icon}</div><div class="row-content"><div class="row-task">${item.task}</div></div></div>`;
}

function tog(id){ cs[id]=!cs[id]; render(); }
function resetAll(){ location.reload(); }
function toggleTheme(){ document.body.classList.toggle('light'); }
function closeReminder(){ document.getElementById("reminderPopup").classList.add("hidden"); }

window.onload = () => {
  const ec=document.getElementById("exCon");
  EXAMPLES.forEach(ex=>{
    const b=document.createElement("button"); b.className="btn-ex"; b.textContent=ex.label;
    b.onclick=()=>{document.getElementById("inputText").value=ex.text; generate();};
    ec.appendChild(b);
  });
};
</script>
</body>
</html>
